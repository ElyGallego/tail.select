/*! pytesNET/rat.select | @version 1.0.0 | @license MIT | @copyright pytesNET <info@pytes.net> */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("rat.select",t):((e="undefined"!=typeof globalThis?globalThis:e||self).rat=e.rat||{},e.rat.select=t())}(this,(function(){"use strict";"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){for(var i=Object(e),s=1;s<arguments.length;s++){var n=arguments[s];if(null!=n)for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(i[o]=n[o])}return i}}),"function"!=typeof CustomEvent.constructor&&(CustomEvent.constructor=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:null};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i});var e=function(){function e(t){this.strings=e[t]||e.en}return e.prototype._=function(e,t){var i=e in this.strings?this.strings[e]:e;return"function"==typeof i&&(i=i.apply(this,t)),void 0!==t&&t.length>0&&t.map((function(e,t){var s=new RegExp("\\["+t.toString()+"\\]","g");i=i.replace(s,e.toString())})),i},e.en={buttonAll:"All",buttonNone:"None",disabled:"This field is disabled",empty:"No options available",multiple:"Choose one or more options...",multipleCount:function(e){return"[0] "+(1===e?"option":"options")+" selected..."},multipleLimit:"No more options selectable",single:"Choose an option..."},e}(),t=function(){function e(e){this.plugins=e}return e.add=function(e,t,i){return!(e in this.plugins)&&(this.plugins[e]={config:t,hooks:i},!0)},e.prototype.hook=function(e){var t=[];for(var i in this.plugins)e in this.plugins[i].hooks&&t.push(this.plugins[i].hooks[e]);return t},e.plugins={},e}(),i=function(){function e(e){if(this.ungrouped="#",this.select=e,this.source=e.source,[].map.call(this.source.querySelectorAll("option:not([value])"),(function(e){""!==e.innerText&&e.setAttribute("value",e.innerText)})),e.get("deselect")&&!e.get("multiple")){var t=this.source.querySelector("option:checked");t&&null===this.source.querySelector("option[selected]")&&(t.selected=!1,this.source.selectedIndex=-1)}}return e.prototype.create=function(e,t){var i=document.createElement("OPTION");return i.value=e,i.innerText=t.title,i.selected=t.selected||!1,i.disabled=t.disabled||!1,i.hidden=t.hidden||!1,t.description&&(i.dataset.description=t.description),i},e.prototype.parse=function(e){for(var t in e){if("string"==typeof e[t])var i=this.create(t,Object({title:e[t]}));else i=this.create(t,e[t]);this.set(i)}return this},e.prototype.get=function(e,t,i){var s={disabled:":disabled",selected:":checked",hidden:"[hidden]"};t=""!==t&&t;var n=i?i.map((function(e){return"!"===e[0]?":not("+s[e.slice(1)]+")":s[e]})):"";if(n+=":not([data-rat-ignore])","number"==typeof e){n="option"+(e>0?":nth-child":":nth-last-child")+"("+Math.abs(e)+")"+n}else{if("string"!=typeof e&&e)return[];n="option"+(e?'[value="'+e+'"]':"")+n}return t?t===this.ungrouped?(n='select[data-rat-select="'+this.source.dataset.ratSelect+'"] > '+n,this.source.parentElement.querySelectorAll(n)):"string"==typeof t?this.source.querySelectorAll('optgroup[label="'+t+'"] '+n):[]:this.source.querySelectorAll(n)},e.prototype.getGroups=function(e){var t=this.source.querySelectorAll("optgroup");return e?t:[].map.call(t,(function(e){return e.label}))},e.prototype.count=function(e,t){if(0===arguments.length)return this.source.options.length;var i=this.get(null,e,t);return i?i.length:0},e.prototype.set=function(e,t,i,s){var n=this;if(!(e instanceof HTMLOptionElement))return[].map.call(e,(function(e,s){return n.set(e,t,i<0?-1:i+s,!1)})),s&&this.select.reload(),this;if(null==t&&(t=e.parentElement.label||!1),"string"==typeof t&&t!==this.ungrouped){var o=this.source.querySelector('optgroup[label="'+t+'"]');o||((o=document.createElement("OPTGROUP")).label=t,o.dataset.select="add",this.source.appendChild(o)),i<0||i>o.children.length?o.appendChild(e):o.insertBefore(e,o.children[i])}if(!t){var r='select[data-rat-select="'+this.source.dataset.ratSelect+'"] > option',l=this.source.parentElement.querySelectorAll(r),a=Math.min(i<0?l.length:i,l.length);this.source.children.length!==a&&l[a-1].nextElementSibling?this.source.insertBefore(e,l[a-1].nextElementSibling||this.source.children[0]):this.source.appendChild(e)}return e.dataset.select="add",s&&this.select.reload(),this},e.prototype.remove=function(e,t){return e instanceof HTMLOptionElement&&(e=[e]),[].map.call(e,(function(e){e.parentElement.removeChild(e)})),t&&this.select.reload,this},e.prototype.handle=function(e,t){var i=this;e instanceof HTMLOptionElement&&(e=[e]);var s=[],n=this.select.get("multiLimit",-1);return[].map.call(e,(function(e){var o={};for(t.hasOwnProperty("disabled")&&t.disabled!==e.disabled&&(o.disabled=e.disabled=!e.disabled),t.hasOwnProperty("hidden")&&t.hidden!==e.hidden&&(o.hidden=e.hidden=!e.hidden);t.hasOwnProperty("selected")&&t.selected!==e.selected&&!e.disabled&&!e.hidden&&!(!e.selected&&i.source.multiple&&n>=0&&n<=i.count(null,[":selected"]))&&(!e.selected||i.source.multiple||i.select.get("deselect",!1));){if(!i.source.multiple&&!e.selected&&i.source.selectedIndex>=0&&s.push([i.source.options[i.source.selectedIndex],{selected:!1}]),o.selected=e.selected=!e.selected,!i.source.multiple&&!e.selected){i.source.selectedIndex=i.source.querySelector('option[value=""]:not(:disabled):checked:first-child')?0:-1}break}Object.keys(o).length>0&&s.push([e,o])})),this.select.update(s),this},e.prototype.selected=function(e,t){return this.handle(e,{selected:t})},e.prototype.disabled=function(e,t){return this.handle(e,{disabled:t})},e.prototype.hidden=function(e,t){return this.handle(e,{hidden:t})},e}(),s=function(){function s(n,o,r){this.source=n,this.config=o,this.options=new(r||i)(this),this.locale=new e(o.locale||"en"),this.plugins=new t(Object.assign({},o.plugins||{})),this.events=function(e){for(var t in e)e[t]=[e[t]];return e}(Object.assign({},o.on||{})),this.config.multiple=this.source.multiple=o.multiple||n.multiple,this.config.disabled=this.source.disabled=o.disabled||n.disabled,this.config.required=this.source.required=o.required||n.required,this.config.placeholder=o.placeholder||n.dataset.placeholder||null;var l=n.querySelector("option[value='']:checked:first-child");if(l&&(l.dataset.ratIgnore="1")&&(this.config.deselect=!l.disabled,this.config.placeholder=l.innerText||o.placeholder),null===(o.rtl||null)&&(this.config.rtl=["ar","fa","he","mdr","sam","syr"].indexOf(o.locale||"en")>=0),null===(o.theme||null)){var a=document.createElement("SPAN");a.className="rat-select-theme-name",document.body.appendChild(a),this.config.theme=window.getComputedStyle(a,":after").content.replace(/"/g,""),document.body.removeChild(a)}n.dataset.ratSelect=s.inst.length.toString(),s.inst[s.inst.length++]=this,this.init()}return s.prototype.init=function(){if(!1===this.trigger("hook","init:before"))return this;if(void 0!==this.config.items){var e=this.config.items;this.options.parse("function"==typeof e?e.call(this,this.options):e)}return!0===this.trigger("hook","build:before")&&(this.build(),this.trigger("hook","build:after")),!0===this.trigger("hook","bind:before")&&(this.bind(),this.trigger("hook","bind:after")),this.get("sourceHide",!0)&&(this.source.style.display="none"),this.source.nextElementSibling?this.source.parentElement.insertBefore(this.select,this.source.nextElementSibling):this.source.parentElement.appendChild(this.select),this.updateLabel(),this.trigger("hook","init:after"),this.query(),this.get("startOpen")&&!this.get("disabled")?this.open():this.source.autofocus&&!this.get("disabled")?this.focus():this},s.prototype.build=function(){var e=this,t=!0===this.get("classNames")?this.source.className:this.get("classNames","");this.select=document.createElement("DIV"),this.select.className=function(t){return["rtl","hideSelected","hideDisabled","hideHidden","disabled","required","multiple","deselect"].map((function(i){e.get(i,"hideHidden"===i)&&t.unshift(i.replace(/[A-Z]/,(function(e){return"-"+e.toLowerCase()})))})),t.unshift("rat-select theme-"+e.get("theme").replace("-"," scheme-").replace("."," ")),t.join(" ").trim()}("string"==typeof t?t.split(" "):t),this.select.tabIndex=this.source.tabIndex||1,this.select.dataset.ratSelect=this.source.dataset.ratSelect;var i,s=this.get("width",250);return null!==s&&(this.select.style.width=s+(isNaN(s)?"":"px")),this.label=document.createElement("LABEL"),this.label.className="select-label",this.dropdown=document.createElement("DIV"),this.dropdown.className="select-dropdown overflow-"+this.get("titleOverflow","clip"),this.dropdown.innerHTML='<div class="dropdown-inner"></div>',this.csv=document.createElement("INPUT"),this.csv.className="select-search",this.csv.name=(!0===(i=this.get("csvOutput",!1))&&(i=e.source.name||""),!1===i?"":i),this.select.appendChild(this.label),this.select.appendChild(this.dropdown),this.get("csvOutput")&&this.select.appendChild(this.csv),this},s.prototype.calculate=function(){var e=this,t=this.dropdown,i=function(i){var s=t.cloneNode(!0);if(s.classList.add("cloned"),e.select.appendChild(s),"string"==typeof i&&":"===i.charAt(0)){for(var n=parseInt(i.slice(1)),o=0,r=[].slice.call(t.querySelectorAll("li")),l=0,a=0;a<r.length&&!(r[a].offsetHeight>0&&(o+=r[a].offsetHeight,l++>=n));a++);s.style.maxHeight=o+"px"}else s.style.maxHeight=i+(isNaN(i)?"":"px");return i=s.offsetHeight>i?i:s.offsetHeight,e.select.removeChild(s),i}(this.get("height",350)?this.get("height",350):"auto");return t.style.maxHeight=i+"px",t.querySelector(".dropdown-inner").style.maxHeight=i+"px",this},s.prototype.bind=function(e){return this.handler||(this.handler=this.handle.bind(this)),e?(document.removeEventListener("keydown",this.handler),document.removeEventListener("click",this.handler),this.get("sourceBind")&&this.source.removeEventListener("change",this.handler),this):(document.addEventListener("keydown",this.handler),document.addEventListener("click",this.handler),this.get("sourceBind")&&this.source.addEventListener("change",this.handler),this)},s.prototype.handle=function(e){var t=this;if(!(e instanceof Event)||this.get("disabled"))return this;var i=e.target;if("keydown"===e.type){if(document.activeElement!==this.select)return;var s=e.keyCode;if(32===s&&!this.select.classList.contains("active"))return this.open();if(!this.select.classList.contains("active"))return;switch(s){case 13:case 32:var n=this.dropdown.querySelector(".dropdown-option.hover");return n?(this.options.selected(this.options.get(n.dataset.value,n.dataset.group)),this.get("stayOpen")||this.get("multiple")?1:this.close()):void 0;case 27:return this.close();case 38:case 40:var o=this.dropdown.querySelectorAll(".dropdown-option:not(.disabled):not(.hidden)"),r=null,l=[].slice.call(o).indexOf(this.dropdown.querySelector(".dropdown-option.hover"));if(l>=0&&o[l+(s>38?1:-1)]&&(r=o[l+(s>38?1:-1)]),r||(r=o[s>38?0:o.length-1]),r){r.classList.add("hover"),o[l]&&o[l].classList.remove("hover");var a=function(e,i){for(;(e=e.parentElement)!==t.dropdown;)i.top+=e.offsetTop;return i}(r,{top:r.offsetTop,height:r.offsetHeight});this.dropdown.scrollTop=Math.max(0,a.top-2*a.height)}return}}if("click"===e.type){if(i===this.label||this.label.contains(i))return this.toggle();if(i.getAttribute("for")===this.source.id)return this.focus();if(!this.select.contains(i)&&!this.get("stayOpen"))return this.close();if(this.dropdown.contains(i)){for(;i&&this.dropdown.contains(i)&&!i.dataset.action;)i=i.parentElement;if(!i.classList.contains("disabled")&&i.dataset.action&&(i.dataset.value||i.dataset.group)){o=this.options.get(i.dataset.value,i.dataset.group);var c=i.dataset.action;if(this.options.selected(o,"toggle"===c?null:"select"===c),!this.get("stayOpen")&&!this.source.multiple)return this.close()}}}"change"===e.type&&CustomEvent},s.prototype.trigger=function(e,t,i){var s=this;if("event"===e){var n={bubbles:!1,cancelable:!0,detail:{args:i,select:this}},o=new CustomEvent("rat::"+t,n),r=this.select.dispatchEvent(o)||this.source.dispatchEvent(o);if("change"===t){var l=new CustomEvent("input",n),a=new CustomEvent("change",n);this.source.dispatchEvent(l),this.source.dispatchEvent(a)}}var c=!0;return this.plugins.hook(t).concat(this.events[t]||[]).map((function(t){"filter"===e?i=t.apply(s,i):!1===t.apply(s,i)&&(c=!1)})),"hook"===e?c:"filter"===e?i:r},s.prototype.query=function(e){var t,i=this;if(!1===this.trigger("hook","query:before"))return this;e="function"==typeof e?e:this.get("query",(function(){return i.options.get()}));for(var s=null,n=void 0,o=[],r=0,l=(e=this.trigger("filter","query",[e])[0]).call(this);r<l.length;r++){var a=l[r],c=a.parentElement instanceof HTMLOptGroupElement?a.parentElement.label:null;if(a=(t=this.trigger("filter","walk",[a,c]))[0],c=t[1],(!this.get("hideEmpty",!0)||""!==a.value)&&c!==n){if(!(o.length>0&&o[0].dataset.group===(c||this.options.ungrouped))){var u=a.parentElement instanceof HTMLOptGroupElement?a.parentElement:null;if(u||(u=document.createElement("OPTGROUP")),null===(s=this.render(u))){n=c;continue}if(!1===s)break;o.unshift(s)}if(null!==(s=this.render(a))){if(!1===s)break;o[0].appendChild(s)}}}var h=this.dropdown.querySelector(".dropdown-inner"),d=h.cloneNode();return o.reverse().map((function(e){return d.appendChild(e)})),this.dropdown.replaceChild(d,h),"scroll"===this.get("titleOverflow")&&[].map.call(this.dropdown.querySelectorAll(".dropdown-option"),(function(e){var t=e.clientWidth-e.querySelector(".option-title").offsetLeft,i=e.querySelector(".option-title").scrollWidth;i>t&&(e.style.textIndent=t-i+"px",e.querySelector(".option-title").style.marginLeft=i-t+"px")})),this.select.classList.contains("active")&&this.calculate(),this.trigger("hook","query:after"),this},s.prototype.render=function(e){var t,i=this,s=e.tagName.toUpperCase(),n=document.createElement("OPTION"===s?"LI":"OL");if("OPTION"===s)n.className="dropdown-option "+function(e){return((i.get("multiple")&&e.hasAttribute("selected")||e.selected?" selected":"")+(e.disabled?" disabled":"")+(e.hidden?" hidden":"")).trim()}(e),n.innerHTML='<span class="option-title">'+e.innerHTML+"</span>",n.dataset.group=(null===(t=e.parentElement)||void 0===t?void 0:t.label)||this.options.ungrouped,n.dataset.value=e.value,n.dataset.action="toggle",e.dataset.description&&(n.innerHTML+='<span clasS="option-description">'+e.dataset.description+"</span>");else{var o=e.label||this.get("ungroupedLabel",null)||"";if(n.className="dropdown-optgroup"+(this.get("stickyGroups")?" optgroup-sticky":""),n.innerHTML='<li class="optgroup-title">'+o+"</li>",n.dataset.group=e.label||this.options.ungrouped,this.get("multiple")&&this.get("multiSelectGroup",1))for(var r=0,l=["buttonAll","buttonNone"];r<l.length;r++){var a=l[r],c=document.createElement("BUTTON");c.dataset.action="buttonAll"===a?"select":"unselect",c.dataset.group=n.dataset.group,c.innerHTML=this.locale._(a),n.querySelector(".optgroup-title").appendChild(c)}}return this.trigger("filter","render#"+s,[n,e,s])[0]},s.prototype.update=function(e){var t=this;return 0===e.length||!0!==this.trigger("hook","update:before",[e])?this:(this.trigger("event","change",[e]),this.source.multiple&&this.get("multiLimit")>0&&this.options.count(null,["selected"])>=this.get("multiLimit")&&this.trigger("event","limit",[e]),[].map.call(e,(function(e){var i=e[0],s=e[1],n=i.value.replace(/('|\\)/g,"\\$1"),o=i.parentElement.label?i.parentElement.label:t.options.ungrouped,r=t.dropdown.querySelector('li[data-value="'+n+'"][data-group="'+o+'"]');if(r)for(var l in s)r.classList[s[l]?"add":"remove"](l)})),this.trigger("hook","update:after",[e]),this.updateCSV().updateLabel())},s.prototype.updateCSV=function(){return this.get("csvOutput")&&(this.csv.value=this.trigger("filter","update#csv",[this.value("csv")])[0]),this},s.prototype.updateLabel=function(e){var t=this.value("array"),i=this.get("multiLimit");e||"function"!=typeof this.get("placeholder")||(e=this.get("placeholder").call(this)),e||(e=this.source.disabled||!this.options.count()?this.source.disabled?"disabled":"empty":this.source.multiple&&t.length>0?i===t.length?"multipleLimit":"multipleCount":this.source.multiple||1!==t.length?this.source.multiple?"multiple":"single":t[0]);var s=!!this.source.multiple&&this.get("placeholderCount",!1);if(s){var n=this.options.count(null,["selected"]),o=this.options.count(null,["!disabled","!hidden"]),r=i<0?o:i;switch(s=!0===s?"count-up":s){case"count-up":s=n;break;case"count-down":s=i-n;break;case"limit":s=r;break;case"both":s=n+"/"+r}"function"==typeof s&&(s=s.call(this))}return this.label.innerHTML=(s?'<span class="label-count">'+s+"</span>":"")+'<span class="label-placeholder">'+this.locale._(e,[t.length])+"</span>",this},s.prototype.open=function(){return this.select.classList.contains("active")||(this.calculate(),this.select.classList.add("active"),this.trigger("event","open",[])),this},s.prototype.close=function(){return this.select.classList.contains("active")?(this.dropdown.style.removeProperty("max-height"),this.select.classList.remove("active"),this.trigger("event","close",[]),this):this},s.prototype.toggle=function(){return this[this.select.classList.contains("active")?"close":"open"]()},s.prototype.reload=function(e){return!0!==this.trigger("hook","reload:before",[e])||(e?this.remove().init():this.query(),this.trigger("hook","reload:after",[e])),this},s.prototype.remove=function(e){return!0!==this.trigger("hook","remove:before",[e])||(e||([].map.call(this.source.querySelectorAll("optgroup[data-select='add']"),(function(e){e.parentElement.removeChild(e)})),[].map.call(this.source.querySelectorAll("option[data-select='add']"),(function(e){e.parentElement.removeChild(e)}))),this.get("sourceHide")&&(this.source.style.removeProperty("display"),this.source.style.removeProperty("visibility")),this.select.parentElement&&this.select.parentElement.removeChild(this.select),this.source.removeAttribute("data-rat-select"),this.trigger("hook","remove:after",[e])),this},s.prototype.value=function(e){void 0!==e&&"auto"!==e||(e=this.source.multiple?"array":"csv");var t=this.options.get(null,null,["selected"]);switch(e){case"csv":return[].map.call(t,(function(e){return e.value})).join(this.get("csvSeparator",","));case"array":return[].map.call(t,(function(e){return e.value}));case"node":return this.source.multiple?[].map.call(t,(function(e){return e.value})):t[0]||null;default:return"array"===e?[]:null}},s.prototype.get=function(e,t){return e in this.config?this.config[e]:t},s.prototype.set=function(e,t,i){if(["multiple","disabled","required"].indexOf(e)>=0){if("disabled"===e)return this[t?"enable":"disable"](i);this.config[e]=this.source[e]=!!e}else this.config[e]=t;return i?this.reload():this},s.prototype.enable=function(e){return this.trigger("event","enable",[e]),this.config.disabled=this.source.disabled=!1,this.select.classList.remove("disabled"),e?this.reload():this},s.prototype.disable=function(e){return this.trigger("event","disable",[e]),this.config.disabled=this.source.disabled=!0,this.select.classList.add("disabled"),e?this.reload():this},s.prototype.focus=function(){return this.select.focus(),this},s.prototype.state=function(e,t){return t=void 0===t?!this.select.classList.contains("state-"+e):t,this.select.classList[t?"add":"remove"]("state-"+e),this},s.prototype.on=function(e,t){var i=this;return e.split(",").map((function(e){i.events[e]=i.events[e]||[],i.events[e].push(t)})),this},s.inst={length:0},s}();function n(e,t,n){var o=function(e){return e instanceof HTMLSelectElement?e.dataset.ratSelect?s.inst[e.dataset.ratSelect]:new s(e,t?Object.assign({},t):{},n||i):null};return"string"==typeof e&&(e=document.querySelectorAll(e)),e instanceof HTMLSelectElement?o(e):[].map.call(e,o)}return n.version="1.0.0",n.status="stable",n.Select=s,n.Options=i,n.Strings=e,n.Plugins=t,n}));
/*! Visit this project on https://rat.md/select *///# sourceMappingURL=rat.select.min.js.map
