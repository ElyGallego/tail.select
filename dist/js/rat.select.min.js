/*! pytesNET/rat.select | @version 1.0.0-rc.1 | @license MIT | @copyright pytesNET <info@pytes.net> */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("rat.select",t):((e="undefined"!=typeof globalThis?globalThis:e||self).rat=e.rat||{},e.rat.select=t())}(this,(function(){"use strict";"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){for(var i=Object(e),s=1;s<arguments.length;s++){var n=arguments[s];if(null!=n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])}return i}}),"undefined"!=typeof CustomEvent&&"function"!=typeof CustomEvent.constructor&&(CustomEvent.constructor=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:null};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i});var e=function(){function e(t){this.strings=e[t]||e.en}return e.prototype._=function(e,t){var i=e in this.strings?this.strings[e]:e;return"function"==typeof i&&(i=i.apply(this,t)),void 0!==t&&t.length>0&&t.map((function(e,t){var s=new RegExp("\\["+t.toString()+"\\]","g");i=i.replace(s,e.toString())})),i},e.en={buttonAll:"All",buttonNone:"None",disabled:"This field is disabled",empty:"No options available",multiple:"Choose one or more options...",multipleCount:function(e){return"[0] "+(1===e?"option":"options")+" selected..."},multipleLimit:"No more options selectable",single:"Choose an option..."},e}(),t=function(){function e(t,i){for(var s in this.plugins={},t)e.plugins[s]&&(this.plugins[s]=new e.plugins[s](i))}return e.add=function(e,t){return!(e in this.plugins)&&(this.plugins[e]=t,!0)},e.prototype.methods=function(e){var t=[];for(var i in this.plugins)e in this.plugins[i]&&t.push(this.plugins[i][e]);return t},e.plugins={},e}(),i=function(){function e(e){if(this.ungrouped="#",this.select=e,this.source=e.source,[].map.call(this.source.querySelectorAll("option:not([value])"),(function(e){""!==e.innerText&&e.setAttribute("value",e.innerText)})),e.get("deselect")&&!e.get("multiple")){var t=this.source.querySelector("option:checked");t&&null===this.source.querySelector("option[selected]")&&(t.selected=!1,this.source.selectedIndex=-1)}}return e.prototype.create=function(e,t){var i=document.createElement("OPTION");return i.value=e,i.innerText=t.title,i.selected=t.selected||!1,i.disabled=t.disabled||!1,i.hidden=t.hidden||!1,t.description&&(i.dataset.description=t.description),i},e.prototype.parse=function(e){for(var t in e){if("string"==typeof e[t])var i=this.create(t,Object({title:e[t]}));else i=this.create(t,e[t]);this.set(i)}return this},e.prototype.get=function(e,t,i){var s={disabled:":disabled",selected:":checked",hidden:"[hidden]"};t=""!==t&&t;var n=i?i.map((function(e){return"!"===e[0]?":not("+s[e.slice(1)]+")":s[e]})):"";if(n+=":not([data-rat-ignore])","number"==typeof e){n="option"+(e>0?":nth-child":":nth-last-child")+"("+Math.abs(e)+")"+n}else{if("string"!=typeof e&&e)return[];n="option"+(e?'[value="'+e+'"]':"")+n}return t?t===this.ungrouped?(n='select[data-rat-select="'+this.source.dataset.ratSelect+'"] > '+n,this.source.parentElement.querySelectorAll(n)):"string"==typeof t?this.source.querySelectorAll('optgroup[label="'+t+'"] '+n):[]:this.source.querySelectorAll(n)},e.prototype.getGroups=function(e){var t=this.source.querySelectorAll("optgroup");return e?t:[].map.call(t,(function(e){return e.label}))},e.prototype.count=function(e,t){if(0===arguments.length)return this.source.options.length;var i=this.get(null,e,t);return i?i.length:0},e.prototype.set=function(e,t,i,s){var n=this;if(!(e instanceof HTMLOptionElement))return[].map.call(e,(function(e,s){return n.set(e,t,i<0?-1:i+s,!1)})),s&&this.select.reload(),this;if(i="number"==typeof i?i:-1,null==t&&(t=e.parentElement&&e.parentElement.label||"#"),"string"==typeof t&&t!==this.ungrouped){var r=this.source.querySelector('optgroup[label="'+t+'"]');r||((r=document.createElement("OPTGROUP")).label=t,r.dataset.select="add",this.source.appendChild(r)),i<0||i>r.children.length?r.appendChild(e):r.insertBefore(e,r.children[i])}if(t===this.ungrouped){var o='select[data-rat-select="'+this.source.dataset.ratSelect+'"] > option',l=this.source.parentElement.querySelectorAll(o),a=Math.min(i<0?l.length:i,l.length);this.source.children.length!==a&&l[a-1].nextElementSibling?this.source.insertBefore(e,l[a-1].nextElementSibling||this.source.children[0]):this.source.appendChild(e)}return e.dataset.select="add",s&&this.select.reload(),this},e.prototype.remove=function(e,t){return e instanceof HTMLOptionElement&&(e=[e]),[].map.call(e,(function(e){e.parentElement.removeChild(e)})),t&&this.select.reload,this},e.prototype.handle=function(e,t){var i=this;e instanceof HTMLOptionElement&&(e=[e]);var s=[],n=this.select.get("multiLimit",-1);return[].map.call(e,(function(e){var r={};for(t.hasOwnProperty("disabled")&&t.disabled!==e.disabled&&(r.disabled=e.disabled=!e.disabled),t.hasOwnProperty("hidden")&&t.hidden!==e.hidden&&(r.hidden=e.hidden=!e.hidden);t.hasOwnProperty("selected")&&t.selected!==e.selected&&!e.disabled&&!e.hidden&&!(!e.selected&&i.source.multiple&&n>=0&&n<=i.count(null,[":selected"]))&&(!e.selected||i.source.multiple||i.select.get("deselect",!1));){if(!i.source.multiple&&!e.selected&&i.source.selectedIndex>=0&&s.push([i.source.options[i.source.selectedIndex],{selected:!1}]),r.selected=e.selected=!e.selected,!i.source.multiple&&!e.selected){i.source.selectedIndex=i.source.querySelector('option[value=""]:not(:disabled):checked:first-child')?0:-1}break}Object.keys(r).length>0&&s.push([e,r])})),this.select.update(s),this},e.prototype.selected=function(e,t){return this.handle(e,{selected:t})},e.prototype.disabled=function(e,t){return this.handle(e,{disabled:t})},e.prototype.hidden=function(e,t){return this.handle(e,{hidden:t})},e}(),s=function(){function s(n,r,o){this.source=n,this.config=r,this.options=new(o||i)(this),this.locale=new e(r.locale||"en"),this.plugins=new t(Object.assign({},r.plugins||{}),this),this.events=function(e){for(var t in e)e[t]=[e[t]];return e}(Object.assign({},r.on||{})),this.config.multiple=this.source.multiple=r.multiple||n.multiple,this.config.disabled=this.source.disabled=r.disabled||n.disabled,this.config.required=this.source.required=r.required||n.required,this.config.placeholder=r.placeholder||n.dataset.placeholder||null;var l=n.querySelector("option[value='']:checked:first-child");if(l&&(l.dataset.ratIgnore="1")&&(this.config.deselect=!l.disabled,this.config.placeholder=l.innerText||r.placeholder),null===(r.rtl||null)&&(this.config.rtl=["ar","fa","he","mdr","sam","syr"].indexOf(r.locale||"en")>=0),null===(r.theme||null)){var a=document.createElement("SPAN");a.className="rat-select-theme-name",document.body.appendChild(a),this.config.theme=window.getComputedStyle(a,":after").content.replace(/"/g,""),document.body.removeChild(a)}n.dataset.ratSelect=s.inst.length.toString(),s.inst[s.inst.length++]=this,this.init()}return s.prototype.init=function(){if(!1===this.trigger("hook","init:before"))return this;if(void 0!==this.config.items){var e=this.config.items;this.options.parse("function"==typeof e?e.call(this,this.options):e)}return this.build(),this.bind(),this.get("sourceHide",!0)&&(this.source.style.display="none"),this.source.nextElementSibling?this.source.parentElement.insertBefore(this.select,this.source.nextElementSibling):this.source.parentElement.appendChild(this.select),this.updateCSV().updateLabel(),this.trigger("hook","init:after"),this.query(),this.get("startOpen")&&!this.get("disabled")?this.open():this.source.autofocus&&!this.get("disabled")?this.focus():this},s.prototype.build=function(){var e=this;if(!1===this.trigger("hook","build:before"))return this;var t=!0===this.get("classNames")?this.source.className:this.get("classNames","")||"";this.select=document.createElement("DIV"),this.select.className=function(t){return["rtl","hideSelected","hideDisabled","hideHidden","disabled","required","multiple","deselect"].map((function(i){e.get(i,"hideHidden"===i)&&t.unshift(i.replace(/[A-Z]/,(function(e){return"-"+e.toLowerCase()})))})),t.unshift("rat-select theme-"+e.get("theme").replace("-"," scheme-").replace("."," ")),t.join(" ").trim()}("string"==typeof t?t.split(" "):t),this.select.tabIndex=this.source.tabIndex||1,this.select.dataset.ratSelect=this.source.dataset.ratSelect;var i,s=this.get("width",250);return null!==s&&(this.select.style.width=s+(isNaN(s)?"":"px")),this.label=document.createElement("LABEL"),this.label.className="select-label",this.label.innerHTML='<div class="label-placeholder"></div>',this.dropdown=document.createElement("DIV"),this.dropdown.className="select-dropdown overflow-"+this.get("titleOverflow","clip"),this.dropdown.innerHTML='<div class="dropdown-inner"></div>',this.csv=document.createElement("INPUT"),this.csv.className="select-search",this.csv.name=(!0===(i=this.get("csvOutput",!1))&&(i=e.source.name||""),!1===i?"":i),this.select.appendChild(this.label),this.select.appendChild(this.dropdown),this.get("csvOutput")&&this.select.appendChild(this.csv),this.trigger("hook","build:after"),this},s.prototype.calculate=function(){var e=this,t=this.dropdown,i=0,s=function(s){var n=t.cloneNode(!0);if(n.classList.add("cloned"),e.select.appendChild(n),"string"==typeof s&&":"===s.charAt(0)){for(var r=parseInt(s.slice(1)),o=0,l=[].slice.call(t.querySelectorAll("li")),a=0,c=0;c<l.length&&!(l[c].offsetHeight>0&&(o+=l[c].offsetHeight,a++>=r));c++);n.style.maxHeight=o+"px",s=o}else n.style.maxHeight=s+(isNaN(s)?"":"px"),s=n.offsetHeight>s?s:n.offsetHeight;return i=n.querySelector(".dropdown-inner").offsetTop,e.select.removeChild(n),s+i}(this.get("height",350)?this.get("height",350):"auto"),n=this.select.getBoundingClientRect(),r=n.top,o=window.innerHeight-(n.top+n.height),l=this.get("openAbove",null)||!(o>=s||o>=r);return s=Math.min(s,(l?r:o)-15),this.select.classList[l?"add":"remove"]("open-top"),t.style.maxHeight=s+"px",t.querySelector(".dropdown-inner").style.maxHeight=s-i+"px",this},s.prototype.bind=function(){return this.handler||(this.handler=this.handle.bind(this)),!1===this.trigger("hook","bind:before")||(document.addEventListener("keydown",this.handler),document.addEventListener("click",this.handler),this.get("sourceBind")&&this.source.addEventListener("change",this.handler),this.trigger("hook","bind:after")),this},s.prototype.handle=function(e){var t=this;if(!1===this.trigger("hook","handle:before",[e]))return this;if(!(e instanceof Event)||this.get("disabled"))return this;var i=e.target;if("keydown"===e.type){if(document.activeElement!==this.select)return;var s=e.keyCode;if(32===s&&!this.select.classList.contains("active"))return this.open();if(!this.select.classList.contains("active"))return;switch(s){case 13:case 32:var n=this.dropdown.querySelector(".dropdown-option.hover");return n?(this.options.selected(this.options.get(n.dataset.value,n.dataset.group)),this.get("stayOpen")||this.get("multiple")?1:this.close()):void 0;case 27:return this.close();case 38:case 40:var r=this.dropdown.querySelectorAll(".dropdown-option:not(.disabled):not(.hidden)"),o=null,l=[].slice.call(r).indexOf(this.dropdown.querySelector(".dropdown-option.hover"));if(l>=0&&r[l+(s>38?1:-1)]&&(o=r[l+(s>38?1:-1)]),o||(o=r[s>38?0:r.length-1]),o){o.classList.add("hover"),r[l]&&r[l].classList.remove("hover");var a=function(e,i){for(;(e=e.parentElement)!==t.dropdown;)i.top+=e.offsetTop;return i}(o,{top:o.offsetTop,height:o.offsetHeight});this.dropdown.scrollTop=Math.max(0,a.top-2*a.height)}return}}if("click"===e.type){if(i===this.label||this.label.contains(i))return this.toggle();if(i.getAttribute("for")===this.source.id)return this.focus();if(!this.select.contains(i)&&!this.get("stayOpen"))return this.close();if(this.dropdown.contains(i)){for(;i&&this.dropdown.contains(i)&&!i.dataset.action;)i=i.parentElement;if(!i.classList.contains("disabled")&&i.dataset.action&&(i.dataset.value||i.dataset.group)){r=this.options.get(i.dataset.value,i.dataset.group);var c=i.dataset.action;if(this.options.selected(r,"toggle"===c?null:"select"===c),!this.get("stayOpen")&&!this.source.multiple)return this.close()}}}if("change"===e.type&&!(e instanceof CustomEvent)){[].map.call(this.select.querySelectorAll(".dropdown-option.active"),(function(e){e.classList.remove("active")}));var u=[];return[].map.call(this.source.querySelectorAll("option:checked"),(function(e){return u.push([e,{selected:!0}])})),this.update(u,!1)}return this.trigger("hook","handle:after",[e]),this},s.prototype.trigger=function(e,t,i){var s=this;if("event"===e){var n={bubbles:!1,cancelable:!0,detail:{args:i,select:this}},r=new CustomEvent("rat::"+t,n),o=this.select.dispatchEvent(r)||this.source.dispatchEvent(r);if("change"===t){var l=new CustomEvent("input",n),a=new CustomEvent("change",n);this.source.dispatchEvent(l),this.source.dispatchEvent(a)}}var c=!0;return this.plugins.methods(t).concat(this.events[t]||[]).map((function(t){"filter"===e?i=t.apply(s,i):!1===t.apply(s,i)&&(c=!1)})),"hook"===e?c:"filter"===e?i:o},s.prototype.query=function(e,t){var i,s=this;if(!1===this.trigger("hook","query:before"))return this;e="function"==typeof e?e:this.get("query",(function(){return s.options.get()}));for(var n=null,r=void 0,o=[],l=0,a=(e=this.trigger("filter","query",[e])[0]).apply(this,t||[]);l<a.length;l++){var c=a[l],u=c.parentElement instanceof HTMLOptGroupElement?c.parentElement.label:null;if(c=(i=this.trigger("filter","walk",[c,u]))[0],u=i[1],(!this.get("hideEmpty",!0)||""!==c.value)&&u!==r){if(!(o.length>0&&o[0].dataset.group===(u||this.options.ungrouped))){var h=c.parentElement instanceof HTMLOptGroupElement?c.parentElement:null;if(h||(h=document.createElement("OPTGROUP")),null===(n=this.render(h))){r=u;continue}if(!1===n)break;o.unshift(n)}if(null!==(n=this.render(c))){if(!1===n)break;o[0].appendChild(n)}}}var d=this.dropdown.querySelector(".dropdown-inner"),p=d.cloneNode();return o.reverse().map((function(e){return p.appendChild(e)})),this.dropdown.replaceChild(p,d),this.dropdown.querySelector(".dropdown-inner").className="dropdown-inner","scroll"===this.get("titleOverflow")&&[].map.call(this.dropdown.querySelectorAll(".dropdown-option"),(function(e){var t=e.clientWidth-e.querySelector(".option-title").offsetLeft,i=e.querySelector(".option-title").scrollWidth;i>t&&(e.style.textIndent=t-i+"px",e.querySelector(".option-title").style.marginLeft=i-t+"px")})),this.select.classList.contains("active")&&this.calculate(),this.trigger("hook","query:after"),this},s.prototype.render=function(e){var t,i=this,s=e.tagName.toLowerCase(),n=document.createElement("option"===s?"LI":"OL");if("option"===s)n.className="dropdown-option "+function(e){return((i.get("multiple")&&e.hasAttribute("selected")||e.selected?" selected":"")+(e.disabled?" disabled":"")+(e.hidden?" hidden":"")).trim()}(e),n.innerHTML='<span class="option-title">'+e.innerHTML+"</span>",n.dataset.group=(null===(t=e.parentElement)||void 0===t?void 0:t.label)||this.options.ungrouped,n.dataset.value=e.value,n.dataset.action="toggle",e.dataset.description&&(n.innerHTML+='<span clasS="option-description">'+e.dataset.description+"</span>");else{var r=e.label||this.get("ungroupedLabel",null)||"";if(n.className="dropdown-optgroup"+(this.get("stickyGroups")?" optgroup-sticky":""),n.innerHTML='<li class="optgroup-title">'+r+"</li>",n.dataset.group=e.label||this.options.ungrouped,this.get("multiple")&&this.get("multiSelectGroup",1))for(var o=0,l=["buttonAll","buttonNone"];o<l.length;o++){var a=l[o],c=document.createElement("BUTTON");c.dataset.action="buttonAll"===a?"select":"unselect",c.dataset.group=n.dataset.group,c.innerHTML=this.locale._(a),n.querySelector(".optgroup-title").appendChild(c)}}return this.trigger("filter","render#"+s,[n,e,s])[0]},s.prototype.update=function(e,t){var i=this;return 0===e.length||!0!==this.trigger("hook","update:before",[e,t])?this:("boolean"==typeof t&&t&&(this.trigger("event","change",[e]),this.source.multiple&&this.get("multiLimit")>0&&this.options.count(null,["selected"])>=this.get("multiLimit")&&this.trigger("event","limit",[e])),[].map.call(e,(function(e){var t=e[0],s=e[1],n=t.value.replace(/('|\\)/g,"\\$1"),r=t.parentElement.label?t.parentElement.label:i.options.ungrouped,o=i.dropdown.querySelector('li[data-value="'+n+'"][data-group="'+r+'"]');if(o)for(var l in s)o.classList[s[l]?"add":"remove"](l)})),this.trigger("hook","update:after",[e,t]),this.updateCSV().updateLabel())},s.prototype.updateCSV=function(){return this.csv.value=this.trigger("filter","update#csv",[this.value("csv")])[0],this},s.prototype.updateLabel=function(e){var t=this.value("array"),i=this.get("multiLimit");e||"function"!=typeof this.get("placeholder")||(e=this.get("placeholder").call(this)),e||(e=this.source.disabled||!this.options.count()?this.source.disabled?"disabled":"empty":this.source.multiple&&t.length>0?i===t.length?"multipleLimit":"multipleCount":this.source.multiple||1!==t.length?this.source.multiple?"multiple":"single":t[0]);var s=!!this.source.multiple&&this.get("placeholderCount",!1);if(s){var n=this.options.count(null,["selected"]),r=this.options.count(null,["!disabled","!hidden"]),o=i<0?r:i;switch(s=!0===s?"count-up":s){case"count-up":s=n;break;case"count-down":s=i-n;break;case"limit":s=o;break;case"both":s=n+"/"+o}"function"==typeof s&&(s=s.call(this))}var l=this.trigger("filter","update#placeholder",[this.locale._(e,[t.length]),s]),a=l[0],c=l[1],u=this.label.querySelector(".label-placeholder");return a&&u&&(u.innerHTML=(c?'<span class="label-count">'+c+"</span>":"")+a),this},s.prototype.open=function(){return this.select.classList.contains("active")||(this.calculate(),this.select.classList.add("active"),this.trigger("event","open",[])),this},s.prototype.close=function(){return this.select.classList.contains("active")?(this.dropdown.style.removeProperty("max-height"),this.select.classList.remove("active"),this.trigger("event","close",[]),this):this},s.prototype.toggle=function(){return this[this.select.classList.contains("active")?"close":"open"]()},s.prototype.reload=function(e){return!0!==this.trigger("hook","reload:before",[e])||(e?this.destroy().init():this.query(),this.trigger("hook","reload:after",[e])),this},s.prototype.destroy=function(e){return!0!==this.trigger("hook","destroy:before",[e])||(e||([].map.call(this.source.querySelectorAll("optgroup[data-select='add']"),(function(e){e.parentElement.removeChild(e)})),[].map.call(this.source.querySelectorAll("option[data-select='add']"),(function(e){e.parentElement.removeChild(e)}))),this.get("sourceHide")&&(this.source.style.removeProperty("display"),this.source.style.removeProperty("visibility")),this.select.parentElement&&this.select.parentElement.removeChild(this.select),this.source.removeAttribute("data-rat-select"),this.trigger("hook","destroy:after",[e])),this},s.prototype.value=function(e){void 0!==e&&"auto"!==e||(e=this.source.multiple?"array":"csv");var t=this.options.get(null,null,["selected"]);switch(e){case"csv":return[].map.call(t,(function(e){return e.value})).join(this.get("csvSeparator",","));case"array":return[].map.call(t,(function(e){return e.value}));case"node":return this.source.multiple?[].map.call(t,(function(e){return e.value})):t[0]||null;default:return"array"===e?[]:null}},s.prototype.get=function(e,t){if(e.indexOf(".")>0){var i=e.split("."),s=i[0],n=i[1],r=this.config.plugins[s];return r&&r[n]?r[n]:t}return e in this.config?this.config[e]:t},s.prototype.set=function(e,t,i){if(e.indexOf(".")>0){var s=e.split("."),n=s[0],r=s[1],o=this.config.plugins[n];return o&&(o[r]=t),i?this.reload():this}if(["multiple","disabled","required"].indexOf(e)>=0){if("disabled"===e)return this[t?"enable":"disable"](i);this.config[e]=this.source[e]=!!e}else this.config[e]=t;return i?this.reload():this},s.prototype.enable=function(e){return this.trigger("event","enable",[e]),this.config.disabled=this.source.disabled=!1,this.select.classList.remove("disabled"),e?this.reload():this},s.prototype.disable=function(e){return this.trigger("event","disable",[e]),this.config.disabled=this.source.disabled=!0,this.select.classList.add("disabled"),e?this.reload():this},s.prototype.focus=function(){return this.select.focus(),this},s.prototype.state=function(e,t){return void 0===t?this.select.classList.contains("state-"+e):(t=null===t?!this.select.classList.contains("state-"+e):t,this.select.classList[t?"add":"remove"]("state-"+e),this)},s.prototype.on=function(e,t){var i=this;return e.split(",").map((function(e){i.events[e]=i.events[e]||[],i.events[e].push(t)})),this},s.inst={length:0},s}();function n(e,t,n){var r=function(e){return e instanceof HTMLSelectElement?e.dataset.ratSelect?s.inst[e.dataset.ratSelect]:new s(e,t?Object.assign({},t):{},n||i):null};return"string"==typeof e&&(e=document.querySelectorAll(e)),e instanceof HTMLSelectElement?r(e):[].map.call(e,r)}return n.version="1.0.0-rc.1",n.status="rc.1",n.Select=s,n.Options=i,n.Strings=e,n.Plugins=t,n}));
/*! Visit this project on https://rat.md/select *///# sourceMappingURL=rat.select.min.js.map
