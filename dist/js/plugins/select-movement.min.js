/*! pytesNET/tail.select v0.6.0-beta | ECMAScript 5 | @copyright pytesNET <info@pytes.net> */
!function(e,t){"function"==typeof define&&define.amd?define(["tail.select"],t):"object"==typeof module&&module.exports?module.exports=t:t(e.tail.select)}("undefined"!=typeof window?window:"undefined"!=typeof global?global:this,function(a){"use strict";var e={move:null,moveHide:!1,moveOrder:!0,pinSelected:!1},t={"init:before":function(){if(!this.get("multiple",0))return!0;var e=this.get("move");return"string"==typeof e?this._container=document.querySelector(e):e instanceof HTMLElement?this._container=e:!0===e&&(this._container=document.createElement("DIV")),this._container&&this._container.classList.add("tail-select-container"),!0},"bind:before":function(e){if(!this._container||!(e instanceof Event&&this._container.contains(e.target)))return!0;var t,n,i,r=e.target;do{if(!r||r==this._container)return!0;t=r.getAttribute("data-value"),n=r.getAttribute("data-group"),i=r.getAttribute("data-action")}while((!i||!t&&!n)&&null!==(r=r.parentElement));if(i&&(t||n)){var a="toggle"===i?[[t,n],"selected"]:[[t,n]];return this.options[i].apply(this.options,a),!1}return!0},"update:after":function(e,t,n){return this.get("move")&&this.updateContainer(e),this.get("pinSelected")&&this.updatePin(e),!0},"query:after":function(e,t){if("walker"!==e)return!0;if(this.get("moveOrder")&&(this._container_index=[].map.call(this._dropdown.querySelectorAll("li.dropdown-option"),function(e){return e}),this._container_items=".".repeat(this._container_index.length-1).split(".")),this.get("move")||this.get("pinSelected")){for(var n=this.options.get(null,null,!0),i=[],r=0;r<n.length;r++)i.push([n[r],{selected:!0}]);this.get("move")&&this.updateContainer(i),this.get("pinSelected")&&this.updatePin(i)}return!0},render:function(e){return e["move-item"]=function(e){var t=e.parentElement instanceof HTMLOptGroupElement&&e.parentElement.label||"#",n=a.__.create("DIV","select-item"),i=a.__.create("SPAN","item-title"),r=a.__.create("SPAN","item-unselect");return n.setAttribute("data-value",e.value||e.innerText),n.setAttribute("data-group",t),n.setAttribute("data-action","unselect"),i.innerText=e.innerText,n.appendChild(r),n.appendChild(i),n},[e]}};return a.plugins.add("movement",e,t),a.prototype.updateContainer=function(e){if(!this._container)return this;for(var t=0;t<e.length;t++){var n=e[t],i=n[0],r=n[1],a=i.value||i.innerText,o=i.parentElement instanceof HTMLOptGroupElement&&i.parentElement.label||"#",s=this._container.querySelector(".select-item[data-value='"+a+"'][data-group='"+o+"']");if(r.selected&&!s){var l=this.render("move-item",i,null);if(!this.get("moveOrder")){this._container.appendChild(l);continue}for(var d=this._dropdown.querySelector("li[data-value='"+a+"'][data-group='"+o+"']"),c=this._container_index.indexOf(d),u=this._container.querySelector(".select-item")?c:this._container_index.length;u++,this._container_items.length>u&&""===this._container_items[u];);this._container_items[u]?this._container.insertBefore(l,this._container_items[u]):this._container.appendChild(l),this._container_items[c]=l}else if(!r.selected&&s){this._container.removeChild(s);var c=this._container_items.indexOf(s);this.get("moveOrder")&&0<=c&&(this._container_items[c]="")}}return this},a.prototype.updatePin=function(e){if(!this.get("pinSelected"))return this;for(var t=0;t<e.length;t++){var n=e[t],i=n[0],r=n[1],a=i.value||i.innerText,o=i.parentElement instanceof HTMLOptGroupElement&&i.parentElement.label||"#",s=this._dropdown.querySelector("li[data-value='"+a+"'][data-group='"+o+"']");if(r.selected&&!s.classList.contains("pinned")){var l=s.cloneNode(!0),d=s.parentElement;s.classList.add("pinned"),l.style.display="none",d.replaceChild(l,s),d.insertBefore(s,d.querySelector("li:not(.pinned)"))}else if(!r.selected&&s.classList.contains("pinned")){var l=this._dropdown.querySelector("li[data-value='"+a+"'][data-group='"+o+"']:not(.pinned)");s.classList.remove("pinned"),l.parentElement.replaceChild(s,l)}}return this},a});