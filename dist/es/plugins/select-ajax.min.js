/*! pytesNET/tail.select v0.6.0-beta | ECMAScript 2015 | @copyright pytesNET <info@pytes.net> */
export function plugin(e){"use strict";var t={ajax:!0,ajaxCallback:null,ajaxOn:"init",ajaxReset:!1,ajaxSearch:!1},a={"init:before":function(){return this.set("ajax",this.get("ajax")&&"function"==typeof this.get("ajaxCallback")),this._ajax=!1,this._ajax_call=!1,this._ajax_result=void 0,!0},"init:after":function(){return this._ajax="init"===this.get("ajaxOn"),!0},open:function(){"open"===this.get("ajaxOn")&&(this._ajax=!0,this.query.apply(this,this._last_query))},"query:before":function(t,a){if(!this.get("ajax")||"finder"===t&&!this.get("ajaxSearch"))return!0;let n="init"===this.get("ajaxOn")?"loading":void 0,r=function(){let i=this.render("ajax-loading",null,[t,a]),n=e.__.create("DIV","dropdown-inner");n.appendChild(i);let r=this._dropdown.querySelector(".dropdown-inner");this._dropdown[(r?"replace":"append")+"Child"](n,r)}.bind(this);if(this._ajax||r(),this._ajax){if(!(void 0===this._ajax_result||this.get("ajaxReset")&&"ajax"!==t))return!0;if(this._ajax_call)return!1;this._ajax_call=!0,function(e){r(),setTimeout(function(){i.call(e,t,a)},0)}.call(this,this)}let l=this.value(),o=this.get("multiLimit",1/0);if(void 0===n){switch(!0){case this.get("disabled"):n="disabled";break;case this.get("multiple")&&o===1/0:n=0===l.length?"multiple":"multipleList";break;case this.get("multiple")&&o!==1/0:n=l.length===o?"multipleLimit":"multipleCount";break;default:n=this.get("multiple")?"multiple":"single"}"disabled"!==n&&(n="string"==typeof this.get("placeholder")?this.get("placeholder"):n)}return this.updateLabel(n).updateCSV(),!1},render:function(t){return t["ajax-loading"]=function(){let t=e.__.create("DIV","dropdown-ajax-loading");return t.innerHTML=`<span>${this._e("loading")}</span>`,t},t["ajax-error"]=function(t){let a=e.__.create("DIV","dropdown-ajax-error");return a.innerHTML=`<span>${t||this._e("error")}</span>`,a},[t]}};let i=function(t,a){let i=this,n={success:function(e,t){if(void 0!==i._ajax_result&&!t)for(let e in i._ajax_result){let t=i._ajax_result[e];"string"==typeof t||t instanceof HTMLElement?i.options.remove(e,!1):i.options.remove([e,t.group||t.optgroup||"#"],!1)}i._ajax_call=!1,i._ajax_result=e,i.options.add(e,null,!1),i.query.apply(i,["ajax",i._last_query[1]])},error:function(n){i._ajax_call=!1,i._ajax_result=void 0;let r=e.__.create("DIV","dropdown-inner"),l=i.render("ajax-error",n,[t,a]);r.appendChild(l);let o=i._dropdown.querySelector(".dropdown-inner");i._dropdown[(o?"replace":"append")+"Child"](r,o)}};(i.get("ajaxCallback")||function(){this.error("No Walker set")}).call(n,t,a)};return e.plugins.add("ajax",t,a),e.strings.en.error="An Error is occured",e.strings.en.loading="Loading",e};