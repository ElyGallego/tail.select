/*! pytesNET/tail.select v0.6.0-beta | ECMAScript 2015 | @copyright pytesNET <info@pytes.net> */
export function plugin(t){"use strict";var e={ajax:!0,ajaxCallback:null,ajaxOn:"init",ajaxReset:!1,ajaxSearch:!1},a={"init:before":function(){return this.set("ajax",this.get("ajax")&&"function"==typeof this.get("ajaxCallback")),this._ajax=!1,this._ajax_call=!1,this._ajax_result=void 0,!0},"init:after":function(){return this._ajax="init"===this.get("ajaxOn"),!0},open:function(){"open"===this.get("ajaxOn")&&(this._ajax=!0,this.query.apply(this,this._last_query))},"query:before":function(e,a){if(!this.get("ajax")||"finder"===e&&!this.get("ajaxSearch"))return!0;let n="init"===this.get("ajaxOn")?"loading":void 0,r=function(i){let n=this.render(`ajax-${i?"waiting":"loading"}`,null,[e,a]),r=t.__.create("DIV","dropdown-inner");r.appendChild(n);let l=this._dropdown.querySelector(".dropdown-inner");this._dropdown[(l?"replace":"append")+"Child"](r,l)}.bind(this);if("input"===this.get("ajaxOn")&&"finder"===e&&(this._ajax=!0),this._ajax||r("input"===this.get("ajaxOn")),this._ajax){if(!(void 0===this._ajax_result||this.get("ajaxReset")&&"ajax"!==e))return!0;if(this._ajax_call)return!1;this._ajax_call=!0,function(t){r(0),setTimeout(function(){i.call(t,e,a)},0)}.call(this,this)}let l=this.value(),o=this.get("multiLimit",1/0);if(void 0===n){switch(!0){case this.get("disabled"):n="disabled";break;case this.get("multiple")&&o===1/0:n=0===l.length?"multiple":"multipleList";break;case this.get("multiple")&&o!==1/0:n=l.length===o?"multipleLimit":"multipleCount";break;default:n=this.get("multiple")?"multiple":"single"}"disabled"!==n&&(n="string"==typeof this.get("placeholder")?this.get("placeholder"):n)}return this.updateLabel(n).updateCSV(),!1},"query:after":function(){return console.log(this._label.querySelector("input")),this._label.querySelector("input").focus(),!0},render:function(e){return e["ajax-waiting"]=function(e){let a=t.__.create("DIV","dropdown-ajax dropdown-ajax-waiting");return a.innerHTML=`<span>${e||this._e("waiting")}</span>`,a},e["ajax-loading"]=function(){let e=t.__.create("DIV","dropdown-ajax dropdown-ajax-loading");return e.innerHTML=`<span>${this._e("loading")}</span>`,e},e["ajax-error"]=function(e){let a=t.__.create("DIV","dropdown-ajax dropdown-ajax-error");return a.innerHTML=`<span>${e||this._e("error")}</span>`,a},[e]}};let i=function(e,a){let i=this,n={success:function(t,e){if(void 0!==i._ajax_result&&!e)for(let t in i._ajax_result){let e=i._ajax_result[t];"string"==typeof e||e instanceof HTMLElement?i.options.remove(t,!0):i.options.remove([t,e.group||e.optgroup||"#"],!0)}i._ajax_call=!1,i._ajax_result=t,i.options.add(t,null,!1),i.query.apply(i,["ajax",i._last_query[1]])},error:function(n){i._ajax_call=!1,i._ajax_result=void 0;let r=t.__.create("DIV","dropdown-inner"),l=i.render("ajax-error",n,[e,a]);r.appendChild(l);let o=i._dropdown.querySelector(".dropdown-inner");i._dropdown[(o?"replace":"append")+"Child"](r,o)}};(i.get("ajaxCallback")||function(){this.error("No Walker set")}).call(n,e,a)};return t.plugins.add("ajax",e,a),t.strings.en.error="An Error is occured",t.strings.en.loading="Loading",t.strings.en.waiting="Waiting for input",t};