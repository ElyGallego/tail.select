/*! pytesNET/tail.select v{{ $data.version }}-beta | {{ $build }} | @copyright pytesNET <info@pytes.net> */
export function plugin(e){"use strict";var t={move:null,moveHide:!1,moveOrder:!0,pinSelected:!1},n={"init:before":function(){if(!this.get("multiple",0))return!0;let e=this.get("move");return"string"==typeof e?this._container=document.querySelector(e):e instanceof HTMLElement?this._container=e:!0===e&&(this._container=document.createElement("DIV")),this._container&&this._container.classList.add("tail-select-container"),!0},"bind:before":function(e){if(!this._container||!(e instanceof Event&&this._container.contains(e.target)))return!0;let t,n,i,r=e.target;do{if(!r||r==this._container)return!0;t=r.getAttribute("data-value"),n=r.getAttribute("data-group"),i=r.getAttribute("data-action")}while((!i||!t&&!n)&&null!==(r=r.parentElement));if(i&&(t||n)){let e="toggle"===i?[[t,n],"selected"]:[[t,n]];return this.options[i].apply(this.options,e),!1}return!0},"update:after":function(e,t,n){return this.get("move")&&this.updateContainer(e),this.get("pinSelected")&&this.updatePin(e),!0},"query:after":function(e,t){if("walker"!==e)return!0;if(this.get("moveOrder")&&(this._container_index=[].map.call(this._dropdown.querySelectorAll("li.dropdown-option"),e=>e),this._container_items=".".repeat(this._container_index.length-1).split(".")),this.get("move")||this.get("pinSelected")){let e=this.options.get(null,null,!0),t=[];for(let n=0;n<e.length;n++)t.push([e[n],{selected:!0}]);this.get("move")&&this.updateContainer(t),this.get("pinSelected")&&this.updatePin(t)}return!0},render:function(t){return t["move-item"]=function(t){let n=t.parentElement instanceof HTMLOptGroupElement&&t.parentElement.label||"#",i=e.__.create("DIV","select-item"),r=e.__.create("SPAN","item-title"),a=e.__.create("SPAN","item-unselect");return i.setAttribute("data-value",t.value||t.innerText),i.setAttribute("data-group",n),i.setAttribute("data-action","unselect"),r.innerText=t.innerText,i.appendChild(a),i.appendChild(r),i},[t]}};return e.plugins.add("movement",t,n),e.prototype.updateContainer=function(e){if(!this._container)return this;for(let t=0;t<e.length;t++){let[n,i]=e[t],r=n.value||n.innerText,a=n.parentElement instanceof HTMLOptGroupElement&&n.parentElement.label||"#",l=this._container.querySelector(`.select-item[data-value='${r}'][data-group='${a}']`);if(i.selected&&!l){let e=this.render("move-item",n,null);if(!this.get("moveOrder")){this._container.appendChild(e);continue}let t=this._dropdown.querySelector(`li[data-value='${r}'][data-group='${a}']`),i=this._container_index.indexOf(t),l=this._container.querySelector(".select-item")?i:this._container_index.length;do{l++}while(this._container_items.length>l&&""===this._container_items[l]);this._container_items[l]?this._container.insertBefore(e,this._container_items[l]):this._container.appendChild(e),this._container_items[i]=e}else if(!i.selected&&l){this._container.removeChild(l);let e=this._container_items.indexOf(l);this.get("moveOrder")&&e>=0&&(this._container_items[e]="")}}return this},e.prototype.updatePin=function(e){if(!this.get("pinSelected"))return this;for(let t=0;t<e.length;t++){let[n,i]=e[t],r=n.value||n.innerText,a=n.parentElement instanceof HTMLOptGroupElement&&n.parentElement.label||"#",l=this._dropdown.querySelector(`li[data-value='${r}'][data-group='${a}']`);if(i.selected&&!l.classList.contains("pinned")){let e=l.cloneNode(!0),t=l.parentElement;l.classList.add("pinned"),e.style.display="none",t.replaceChild(e,l),t.insertBefore(l,t.querySelector("li:not(.pinned)"))}else if(!i.selected&&l.classList.contains("pinned")){let e=this._dropdown.querySelector(`li[data-value='${r}'][data-group='${a}']:not(.pinned)`);l.classList.remove("pinned"),e.parentElement.replaceChild(l,e)}}return this},e};