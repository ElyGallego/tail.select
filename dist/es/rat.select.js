/*! pytesNET/rat.select | @version 1.0.0-rc.1 | @license MIT | @copyright pytesNET <info@pytes.net> */
class e{constructor(t){this.strings=e[t]||e.en}_(e,t){let s=e in this.strings?this.strings[e]:e;return"function"==typeof s&&(s=s.apply(this,t)),void 0!==t&&t.length>0&&t.map(((e,t)=>{let i=new RegExp("\\["+t.toString()+"\\]","g");s=s.replace(i,e.toString())})),s}}e.en={buttonAll:"All",buttonNone:"None",disabled:"This field is disabled",empty:"No options available",multiple:"Choose one or more options...",multipleCount:e=>`[0] ${1===e?"option":"options"} selected...`,multipleLimit:"No more options selectable",single:"Choose an option..."};class t{constructor(e,s){this.plugins={};for(let i in e)t.plugins[i]&&(this.plugins[i]=new t.plugins[i](s))}static add(e,t){return!(e in this.plugins)&&(this.plugins[e]=t,!0)}methods(e){let t=[];for(let s in this.plugins)e in this.plugins[s]&&t.push(this.plugins[s][e]);return t}}t.plugins={};class s{constructor(e){if(this.ungrouped="#",this.select=e,this.source=e.source,[].map.call(this.source.querySelectorAll("option:not([value])"),(e=>{""!==e.innerText&&e.setAttribute("value",e.innerText)})),e.get("deselect")&&!e.get("multiple")){let e=this.source.querySelector("option:checked");e&&null===this.source.querySelector("option[selected]")&&(e.selected=!1,this.source.selectedIndex=-1)}}create(e,t){let s=document.createElement("OPTION");return s.value=e,s.innerText=t.title,s.selected=t.selected||!1,s.disabled=t.disabled||!1,s.hidden=t.hidden||!1,t.description&&(s.dataset.description=t.description),s}parse(e){for(let s in e){if("string"==typeof e[s])var t=this.create(s,Object({title:e[s]}));else t=this.create(s,e[s]);this.set(t)}return this}get(e,t,s){let i={disabled:":disabled",selected:":checked",hidden:"[hidden]"};t=""!==t&&t;let l=s?s.map((e=>"!"===e[0]?`:not(${i[e.slice(1)]})`:i[e])):"";if(l+=":not([data-rat-ignore])","number"==typeof e){l=`option${e>0?":nth-child":":nth-last-child"}(${Math.abs(e)})${l}`}else{if("string"!=typeof e&&e)return[];l=`option${e?`[value="${e}"]`:""}${l}`}return t?t===this.ungrouped?(l=`select[data-rat-select="${this.source.dataset.ratSelect}"] > ${l}`,this.source.parentElement.querySelectorAll(l)):"string"==typeof t?this.source.querySelectorAll(`optgroup[label="${t}"] ${l}`):[]:this.source.querySelectorAll(l)}getGroups(e){let t=this.source.querySelectorAll("optgroup");return e?t:[].map.call(t,(e=>e.label))}count(e,t){if(0===arguments.length)return this.source.options.length;let s=this.get(null,e,t);return s?s.length:0}set(e,t,s,i){if(!(e instanceof HTMLOptionElement))return[].map.call(e,((e,i)=>this.set(e,t,s<0?-1:s+i,!1))),i&&this.select.reload(),this;if(s="number"==typeof s?s:-1,null==t&&(t=e.parentElement&&e.parentElement.label||"#"),"string"==typeof t&&t!==this.ungrouped){let i=this.source.querySelector(`optgroup[label="${t}"]`);i||(i=document.createElement("OPTGROUP"),i.label=t,i.dataset.select="add",this.source.appendChild(i)),s<0||s>i.children.length?i.appendChild(e):i.insertBefore(e,i.children[s])}if(t===this.ungrouped){let t=`select[data-rat-select="${this.source.dataset.ratSelect}"] > option`,i=this.source.parentElement.querySelectorAll(t),l=Math.min(s<0?i.length:s,i.length);this.source.children.length!==l&&i[l-1].nextElementSibling?this.source.insertBefore(e,i[l-1].nextElementSibling||this.source.children[0]):this.source.appendChild(e)}return e.dataset.select="add",i&&this.select.reload(),this}remove(e,t){return e instanceof HTMLOptionElement&&(e=[e]),[].map.call(e,(e=>{e.parentElement.removeChild(e)})),t&&this.select.reload,this}handle(e,t){e instanceof HTMLOptionElement&&(e=[e]);let s=[],i=this.select.get("multiLimit",-1);return[].map.call(e,(e=>{let l={};for(t.hasOwnProperty("disabled")&&t.disabled!==e.disabled&&(l.disabled=e.disabled=!e.disabled),t.hasOwnProperty("hidden")&&t.hidden!==e.hidden&&(l.hidden=e.hidden=!e.hidden);t.hasOwnProperty("selected")&&t.selected!==e.selected&&!e.disabled&&!e.hidden&&!(!e.selected&&this.source.multiple&&i>=0&&i<=this.count(null,[":selected"]))&&(!e.selected||this.source.multiple||this.select.get("deselect",!1));){if(!this.source.multiple&&!e.selected&&this.source.selectedIndex>=0&&s.push([this.source.options[this.source.selectedIndex],{selected:!1}]),l.selected=e.selected=!e.selected,!this.source.multiple&&!e.selected){let e='option[value=""]:not(:disabled):checked:first-child';this.source.selectedIndex=this.source.querySelector(e)?0:-1}break}Object.keys(l).length>0&&s.push([e,l])})),this.select.update(s),this}selected(e,t){return this.handle(e,{selected:t})}disabled(e,t){return this.handle(e,{disabled:t})}hidden(e,t){return this.handle(e,{hidden:t})}}class i{constructor(l,n,r){this.source=l,this.config=n,this.options=new(r||s)(this),this.locale=new e(n.locale||"en"),this.plugins=new t(Object.assign({},n.plugins||{}),this),this.events=(e=>{for(let t in e)e[t]=[e[t]];return e})(Object.assign({},n.on||{})),this.config.multiple=this.source.multiple=n.multiple||l.multiple,this.config.disabled=this.source.disabled=n.disabled||l.disabled,this.config.required=this.source.required=n.required||l.required,this.config.placeholder=n.placeholder||l.dataset.placeholder||null;let o=l.querySelector("option[value='']:checked:first-child");if(o&&(o.dataset.ratIgnore="1")&&(this.config.deselect=!o.disabled,this.config.placeholder=o.innerText||n.placeholder),null===(n.rtl||null)&&(this.config.rtl=["ar","fa","he","mdr","sam","syr"].indexOf(n.locale||"en")>=0),null===(n.theme||null)){let e=document.createElement("SPAN");e.className="rat-select-theme-name",document.body.appendChild(e),this.config.theme=window.getComputedStyle(e,":after").content.replace(/"/g,""),document.body.removeChild(e)}l.dataset.ratSelect=i.inst.length.toString(),i.inst[i.inst.length++]=this,this.init()}init(){if(!1===this.trigger("hook","init:before"))return this;if(void 0!==this.config.items){let e=this.config.items;this.options.parse("function"==typeof e?e.call(this,this.options):e)}return this.build(),this.bind(),this.get("sourceHide",!0)&&(this.source.style.display="none"),this.source.nextElementSibling?this.source.parentElement.insertBefore(this.select,this.source.nextElementSibling):this.source.parentElement.appendChild(this.select),this.updateLabel(),this.trigger("hook","init:after"),this.query(),this.get("startOpen")&&!this.get("disabled")?this.open():this.source.autofocus&&!this.get("disabled")?this.focus():this}build(){if(!1===this.trigger("hook","build:before"))return this;let e=!0===this.get("classNames")?this.source.className:this.get("classNames","");this.select=document.createElement("DIV"),this.select.className=(e=>(["rtl","hideSelected","hideDisabled","hideHidden","disabled","required","multiple","deselect"].map((t=>{this.get(t,"hideHidden"===t)&&e.unshift(t.replace(/[A-Z]/,(e=>`-${e.toLowerCase()}`)))})),e.unshift(`rat-select theme-${this.get("theme").replace("-"," scheme-").replace("."," ")}`),e.join(" ").trim()))("string"==typeof e?e.split(" "):e),this.select.tabIndex=this.source.tabIndex||1,this.select.dataset.ratSelect=this.source.dataset.ratSelect;let t=this.get("width",250);return null!==t&&(this.select.style.width=t+(isNaN(t)?"":"px")),this.label=document.createElement("LABEL"),this.label.className="select-label",this.label.innerHTML='<div class="label-placeholder"></div>',this.dropdown=document.createElement("DIV"),this.dropdown.className=`select-dropdown overflow-${this.get("titleOverflow","clip")}`,this.dropdown.innerHTML='<div class="dropdown-inner"></div>',this.csv=document.createElement("INPUT"),this.csv.className="select-search",this.csv.name=(e=>(!0===e&&(e=this.source.name||""),!1===e?"":e))(this.get("csvOutput",!1)),this.select.appendChild(this.label),this.select.appendChild(this.dropdown),this.get("csvOutput")&&this.select.appendChild(this.csv),this.trigger("hook","build:after"),this}calculate(){let e=this.dropdown,t=0,s=(s=>{let i=e.cloneNode(!0);if(i.classList.add("cloned"),this.select.appendChild(i),"string"==typeof s&&":"===s.charAt(0)){let t=parseInt(s.slice(1)),l=0,n=[].slice.call(e.querySelectorAll("li"));for(let e=0,s=0;s<n.length&&!(n[s].offsetHeight>0&&(l+=n[s].offsetHeight,e++>=t));s++);i.style.maxHeight=l+"px",s=l}else i.style.maxHeight=s+(isNaN(s)?"":"px"),s=i.offsetHeight>s?s:i.offsetHeight;return t=i.querySelector(".dropdown-inner").offsetTop,this.select.removeChild(i),s+t})(this.get("height",350)?this.get("height",350):"auto"),i=this.select.getBoundingClientRect(),l=i.top,n=window.innerHeight-(i.top+i.height),r=this.get("openAbove",null)||!(n>=s||n>=l);return s=Math.min(s,(r?l:n)-15),this.select.classList[r?"add":"remove"]("open-top"),e.style.maxHeight=s+"px",e.querySelector(".dropdown-inner").style.maxHeight=s-t+"px",this}bind(){return this.handler||(this.handler=this.handle.bind(this)),!1===this.trigger("hook","bind:before")||(document.addEventListener("keydown",this.handler),document.addEventListener("click",this.handler),this.get("sourceBind")&&this.source.addEventListener("change",this.handler),this.trigger("hook","bind:after")),this}handle(e){if(!1===this.trigger("hook","handle:before",[e]))return this;if(!(e instanceof Event)||this.get("disabled"))return this;let t=e.target;if("keydown"===e.type){if(document.activeElement!==this.select)return;let t=e.keyCode,s=".dropdown-option:not(.disabled):not(.hidden)";if(32===t&&!this.select.classList.contains("active"))return this.open();if(!this.select.classList.contains("active"))return;switch(t){case 13:case 32:let e=this.dropdown.querySelector(".dropdown-option.hover");return e?(this.options.selected(this.options.get(e.dataset.value,e.dataset.group)),this.get("stayOpen")||this.get("multiple")?1:this.close()):void 0;case 27:return this.close();case 38:case 40:let i=this.dropdown.querySelectorAll(s),l=null,n=[].slice.call(i).indexOf(this.dropdown.querySelector(".dropdown-option.hover"));if(n>=0&&i[n+(t>38?1:-1)]&&(l=i[n+(t>38?1:-1)]),l||(l=i[t>38?0:i.length-1]),l){l.classList.add("hover"),i[n]&&i[n].classList.remove("hover");let e=((e,t)=>{for(;(e=e.parentElement)!==this.dropdown;)t.top+=e.offsetTop;return t})(l,{top:l.offsetTop,height:l.offsetHeight});this.dropdown.scrollTop=Math.max(0,e.top-2*e.height)}return}}if("click"===e.type){if(t===this.label||this.label.contains(t))return this.toggle();if(t.getAttribute("for")===this.source.id)return this.focus();if(!this.select.contains(t)&&!this.get("stayOpen"))return this.close();if(this.dropdown.contains(t)){for(;t&&this.dropdown.contains(t)&&!t.dataset.action;)t=t.parentElement;if(!t.classList.contains("disabled")&&t.dataset.action&&(t.dataset.value||t.dataset.group)){let e=this.options.get(t.dataset.value,t.dataset.group),s=t.dataset.action;if(this.options.selected(e,"toggle"===s?null:"select"===s),!this.get("stayOpen")&&!this.source.multiple)return this.close()}}}if("change"===e.type&&!(e instanceof CustomEvent)){[].map.call(this.select.querySelectorAll(".dropdown-option.active"),(e=>{e.classList.remove("active")}));let e=[];return[].map.call(this.source.querySelectorAll("option:checked"),(t=>e.push([t,{selected:!0}]))),this.update(e,!1)}return this.trigger("hook","handle:after",[e]),this}trigger(e,t,s){if("event"===e){let e={bubbles:!1,cancelable:!0,detail:{args:s,select:this}},l=new CustomEvent(`rat::${t}`,e);var i=this.select.dispatchEvent(l)||this.source.dispatchEvent(l);if("change"===t){let t=new CustomEvent("input",e),s=new CustomEvent("change",e);this.source.dispatchEvent(t),this.source.dispatchEvent(s)}}let l=!0;return this.plugins.methods(t).concat(this.events[t]||[]).map((t=>{"filter"===e?s=t.apply(this,s):!1===t.apply(this,s)&&(l=!1)})),"hook"===e?l:"filter"===e?s:i}query(e,t){if(!1===this.trigger("hook","query:before"))return this;e="function"==typeof e?e:this.get("query",(()=>this.options.get()));let s,i=null,l=[],n=(e=this.trigger("filter","query",[e])[0]).apply(this,t||[]);for(let e of n){let t=e.parentElement instanceof HTMLOptGroupElement?e.parentElement.label:null;if([e,t]=this.trigger("filter","walk",[e,t]),(!this.get("hideEmpty",!0)||""!==e.value)&&t!==s){if(!(l.length>0&&l[0].dataset.group===(t||this.options.ungrouped))){let n=e.parentElement instanceof HTMLOptGroupElement?e.parentElement:null;if(n||(n=document.createElement("OPTGROUP")),null===(i=this.render(n))){s=t;continue}if(!1===i)break;l.unshift(i)}if(null!==(i=this.render(e))){if(!1===i)break;l[0].appendChild(i)}}}let r=this.dropdown.querySelector(".dropdown-inner"),o=r.cloneNode();return l.reverse().map((e=>o.appendChild(e))),this.dropdown.replaceChild(o,r),this.dropdown.querySelector(".dropdown-inner").className="dropdown-inner","scroll"===this.get("titleOverflow")&&[].map.call(this.dropdown.querySelectorAll(".dropdown-option"),(e=>{let t=e.clientWidth-e.querySelector(".option-title").offsetLeft,s=e.querySelector(".option-title").scrollWidth;s>t&&(e.style.textIndent=t-s+"px",e.querySelector(".option-title").style.marginLeft=s-t+"px")})),this.select.classList.contains("active")&&this.calculate(),this.trigger("hook","query:after"),this}render(e){var t;let s=e.tagName.toLowerCase(),i=document.createElement("option"===s?"LI":"OL"),l=e=>((this.get("multiple")&&e.hasAttribute("selected")||e.selected?" selected":"")+(e.disabled?" disabled":"")+(e.hidden?" hidden":"")).trim();if("option"===s)i.className="dropdown-option "+l(e),i.innerHTML=`<span class="option-title">${e.innerHTML}</span>`,i.dataset.group=(null===(t=e.parentElement)||void 0===t?void 0:t.label)||this.options.ungrouped,i.dataset.value=e.value,i.dataset.action="toggle",e.dataset.description&&(i.innerHTML+=`<span clasS="option-description">${e.dataset.description}</span>`);else{let t=e.label||this.get("ungroupedLabel",null)||"";if(i.className="dropdown-optgroup"+(this.get("stickyGroups")?" optgroup-sticky":""),i.innerHTML=`<li class="optgroup-title">${t}</li>`,i.dataset.group=e.label||this.options.ungrouped,this.get("multiple")&&this.get("multiSelectGroup",1))for(let e of["buttonAll","buttonNone"]){let t=document.createElement("BUTTON");t.dataset.action="buttonAll"===e?"select":"unselect",t.dataset.group=i.dataset.group,t.innerHTML=this.locale._(e),i.querySelector(".optgroup-title").appendChild(t)}}return this.trigger("filter",`render#${s}`,[i,e,s])[0]}update(e,t){return 0===e.length||!0!==this.trigger("hook","update:before",[e,t])?this:("boolean"==typeof t&&t&&(this.trigger("event","change",[e]),this.source.multiple&&this.get("multiLimit")>0&&this.options.count(null,["selected"])>=this.get("multiLimit")&&this.trigger("event","limit",[e])),[].map.call(e,(e=>{let[t,s]=e,i=t.value.replace(/('|\\)/g,"\\$1"),l=t.parentElement.label?t.parentElement.label:this.options.ungrouped,n=this.dropdown.querySelector(`li[data-value="${i}"][data-group="${l}"]`);if(n)for(let e in s)n.classList[s[e]?"add":"remove"](e)})),this.trigger("hook","update:after",[e,t]),this.updateCSV().updateLabel())}updateCSV(){let e=this.trigger("filter","update#csv",[this.value("csv")])[0];return this.get("csvOutput")&&e&&(this.csv.value=e),this}updateLabel(e){let t=this.value("array"),s=this.get("multiLimit");e||"function"!=typeof this.get("placeholder")||(e=this.get("placeholder").call(this)),e||(e=this.source.disabled||!this.options.count()?this.source.disabled?"disabled":"empty":this.source.multiple&&t.length>0?s===t.length?"multipleLimit":"multipleCount":this.source.multiple||1!==t.length?this.source.multiple?"multiple":"single":t[0]);let i=!!this.source.multiple&&this.get("placeholderCount",!1);if(i){let e=this.options.count(null,["selected"]),t=this.options.count(null,["!disabled","!hidden"]),l=s<0?t:s;switch(i=!0===i?"count-up":i,i){case"count-up":i=e;break;case"count-down":i=s-e;break;case"limit":i=l;break;case"both":i=`${e}/${l}`}"function"==typeof i&&(i=i.call(this))}let[l,n]=this.trigger("filter","update#placeholder",[this.locale._(e,[t.length]),i]),r=this.label.querySelector(".label-placeholder");return l&&r&&(r.innerHTML=`${n?`<span class="label-count">${n}</span>`:""}${l}`),this}open(){return this.select.classList.contains("active")||(this.calculate(),this.select.classList.add("active"),this.trigger("event","open",[])),this}close(){return this.select.classList.contains("active")?(this.dropdown.style.removeProperty("max-height"),this.select.classList.remove("active"),this.trigger("event","close",[]),this):this}toggle(){return this[this.select.classList.contains("active")?"close":"open"]()}reload(e){return!0!==this.trigger("hook","reload:before",[e])||(e?this.remove().init():this.query(),this.trigger("hook","reload:after",[e])),this}remove(e){return!0!==this.trigger("hook","remove:before",[e])||(e||([].map.call(this.source.querySelectorAll("optgroup[data-select='add']"),(e=>{e.parentElement.removeChild(e)})),[].map.call(this.source.querySelectorAll("option[data-select='add']"),(e=>{e.parentElement.removeChild(e)}))),this.get("sourceHide")&&(this.source.style.removeProperty("display"),this.source.style.removeProperty("visibility")),this.select.parentElement&&this.select.parentElement.removeChild(this.select),this.source.removeAttribute("data-rat-select"),this.trigger("hook","remove:after",[e])),this}value(e){void 0!==e&&"auto"!==e||(e=this.source.multiple?"array":"csv");let t=this.options.get(null,null,["selected"]);switch(e){case"csv":return[].map.call(t,(e=>e.value)).join(this.get("csvSeparator",","));case"array":return[].map.call(t,(e=>e.value));case"node":return this.source.multiple?[].map.call(t,(e=>e.value)):t[0]||null;default:return"array"===e?[]:null}}get(e,t){if(e.indexOf(".")>0){let[s,i]=e.split("."),l=this.config.plugins[s];return l&&l[i]?l[i]:t}return e in this.config?this.config[e]:t}set(e,t,s){if(e.indexOf(".")>0){let[i,l]=e.split("."),n=this.config.plugins[i];return n&&(n[l]=t),s?this.reload():this}if(["multiple","disabled","required"].indexOf(e)>=0){if("disabled"===e)return this[t?"enable":"disable"](s);this.config[e]=this.source[e]=!!e}else this.config[e]=t;return s?this.reload():this}enable(e){return this.trigger("event","enable",[e]),this.config.disabled=this.source.disabled=!1,this.select.classList.remove("disabled"),e?this.reload():this}disable(e){return this.trigger("event","disable",[e]),this.config.disabled=this.source.disabled=!0,this.select.classList.add("disabled"),e?this.reload():this}focus(){return this.select.focus(),this}state(e,t){return void 0===t?this.select.classList.contains(`state-${e}`):(t=null===t?!this.select.classList.contains(`state-${e}`):t,this.select.classList[t?"add":"remove"](`state-${e}`),this)}on(e,t){return e.split(",").map((e=>{this.events[e]=this.events[e]||[],this.events[e].push(t)})),this}}function l(e,t,l){let n=e=>e instanceof HTMLSelectElement?e.dataset.ratSelect?i.inst[e.dataset.ratSelect]:new i(e,t?Object.assign({},t):{},l||s):null;return"string"==typeof e&&(e=document.querySelectorAll(e)),e instanceof HTMLSelectElement?n(e):[].map.call(e,n)}i.inst={length:0},l.version="1.0.0-rc.1",l.status="rc.1",l.Select=i,l.Options=s,l.Strings=e,l.Plugins=t;export default l;
/*! Visit this project on https://rat.md/select *///# sourceMappingURL=rat.select.js.map
