/* tail.select 0.3.0 @ https://github.com/pytesNET/tail.select */
!function(e){"use strict";var t=e,h=e.document,n={hasClass:function(e,t){return new RegExp("(|s+)"+t+"(s+|)").test(e.className)},addClass:function(e,t){return new RegExp("(|s+)"+t+"(s+|)").test(e.className)||(e.className=(e.className.trim()+" "+t.trim()).trim()),e},removeClass:function(e,t){var i=new RegExp("(|s+)("+t+")(s+|)");return i.test(e.className)&&(e.className=e.className.replace(i,"$1$3").trim()),e},trigger:function(e,t,i){if(CustomEvent&&"undefined"!=typeof CustomEvent){var s=new CustomEvent(t,i);return e.dispatchEvent(s)}return(s=h.createEvent("CustomEvent")).initCustomEvent(t,!!i.bubbles,!!i.cancelable,i.detail),e.dispatchEvent(s)},animate:function(e,t,i,s){if(e.hasAttribute("data-tail-animation")){if(!s)return;clearInterval(n.animation[e.getAttribute("data-tail-animation")])}e.setAttribute("data-tail-animation","tail-"+ ++this.animationCounter),this.animation["tail-"+this.animationCounter]=setInterval(function(e,t,i){var s=e.getAttribute("data-tail-animation");0==t.call(e,e)&&(clearInterval(i.animation[s]),e.parentElement&&e.removeAttribute("data-tail-animation"))},i,e,t,this)},animation:{},animationCounter:0},l=function(e,t){if("string"==typeof e&&(e=h.querySelectorAll(e)),e instanceof NodeList||e instanceof HTMLCollection){if(0==e.length)return!1;for(var i=new Array,s=0;s<e.length;s++)i.push(new l(e[s],t));return 1==i.length?i[0]:i}if(void 0===this)return new l(e,t);if(!(e instanceof Element)||e.tagName&&"SELECT"!=e.tagName)return!1;if(e.hasAttribute("data-tail-select")&&l.instances[e.getAttribute("data-tail-select")])return l.instances[e.getAttribute("data-tail-select")];t=t||{};return e.hasAttribute("multiple")&&(t.multiple=e.multiple),e.hasAttribute("placeholder")?t.placeholder=e.placeholder:e.hasAttribute("data-placeholder")&&(t.placeholder=e.getAttribute("data-placeholder")),t.width&&"auto"==t.width&&(t.width=e.offsetWidth+30),this.e=e,this.id=++l.count,this.con=Object.assign({},l.defaults,t),(l.instances["tail-"+this.id]=this).init()};l.version="0.3.0",l.status="alpha",l.count=0,l.instances={},l.defaults={width:null,height:null,classNames:null,placeholder:null,deselect:!1,animate:!1,openAbove:null,stayOpen:!1,startOpen:!1,multiple:!1,multiLimit:-1,multiShowCount:!0,multiContainer:!1,descriptions:!1,items:{},sortItems:!1,sortGroups:!1,search:!1,searchFocus:!0,searchMarked:!0,hideSelect:!0,hideSelected:!1,hideDisabled:!1,bindSourceSelect:!1},l.strings={empty:"No options available",limit:"You can't select more options",selectLimit:"Select up to %d options....",placeholder:"Select an option...",searchField:"Type in to search...",searchEmpty:"No Results found...."};var c=function(e){return l.strings.hasOwnProperty(e)?l.strings[e]:e};l.prototype={e:null,id:0,con:{},options:{},select:null,label:null,dropdown:null,container:null,init:function(){var r=this,e=new Array("tail-select"),t=1==this.con.classNames?this.e.className:this.con.classNames;if(("string"==typeof t||t instanceof Array)&&e.push(t instanceof Array?t.join(" "):t),r.con.hideSelected&&e.push("hide-selected"),r.con.hideDisabled&&e.push("hide-disabled"),r.con.multiple&&e.push("multiple"),r.con.deselect&&e.push("deselect"),this.select=h.createElement("DIV"),this.select.className=e.join(" "),isNaN(parseInt(this.con.width))||(this.select.style.width=parseInt(this.con.width)+"px"),this.label=h.createElement("DIV"),this.label.className="tail-select-label",this.label.innerHTML='<span class="tail-label-inner"></span>',this.con.multiple&&this.con.multiShowCount&&(this.label.innerHTML='<span class="tail-label-count">0</span>'+this.label.innerHTML),this.label.addEventListener("click",function(e){r.toggle.call(r),n.hasClass(r.select,"active")&&r.con.search&&r.con.searchFocus&&r.dropdown.querySelector("input").focus()}),this.select.appendChild(this.label),this.setLabel("placeholder"),this.dropdown=h.createElement("DIV"),this.dropdown.className="tail-select-dropdown",this.dropdown.innerHTML='<div class="tail-dropdown-inner"></div>',isNaN(parseInt(this.con.width))||(this.dropdown.style.width=parseInt(this.con.width)+"px"),isNaN(parseInt(this.con.height))||(this.dropdown.children[0].style.maxHeight=parseInt(this.con.height)+"px"),this.select.appendChild(this.dropdown),this.con.search&&(this.search=h.createElement("DIV"),this.search.className="tail-dropdown-search",this.search.innerHTML='<input type="text" class="tail-search-input" placeholder="'+c("searchField")+'" />',this.search.querySelector("input").addEventListener("input",function(e){2<this.value.length?r.build(this.value):r.build()}),this.dropdown.insertBefore(this.search,this.dropdown.children[0])),this.con.multiple&&h.querySelector(this.con.multiContainer)&&(this.container=h.querySelector(this.con.multiContainer),this.container.className+=" tail-select-container"),this.options=new s(this.e,r),this.options.init(),"object"==typeof this.con.items)for(var i in this.con.items)"string"==typeof this.con.items[i]&&(this.con.items[i]={value:this.con.items[i]}),this.options.add(i,this.con.items[i].value,this.con.items[i].group,this.con.items[i].selected,this.con.items[i].disabled);return this.build(),h.addEventListener("click",function(e){n.hasClass(r.select,"active")&&(r.select.contains(e.target)||r.e.contains(e.target)||e.target!=r.select&&e.target!=r.e&&(r.con.stayOpen||r.close.call(r)))}),this.con.bindSourceSelect&&this.e.addEventListener("change",function(e){var t=function(e,t){for(var i,s,l,n,a=r.options.selected.slice(0),o=0;o<e.length;o++)s=(i=e[o]).value||i.innerText,n="OPTGROUP"==i.parentElement.tagName?i.parentElement.label:"#",null!=(l=r.options.get(s,n))&&(r.options.is("selected",l)||r.options.handle("select",l),0<=a.indexOf(i)&&a.splice(a.indexOf(i),1));for(var o in a)r.options.handle("unselect",a[o])};if(!this.multiple&&this.selectedIndex)r.choose("select",this.options[this.selectedIndex]);else if(this.selectedOptions)t(this.selectedOptions);else{for(var i=new Array,s=0;s<this.options.length;s++)this.options[s].selected&&i.push(this.options[s]);t(i)}}),this.e.parentElement.insertBefore(this.select,this.e),this.e.setAttribute("data-tail-select","tail-"+this.id),this.con.hideSelect&&(this.e.style.display="none"),r.con.startOpen&&this.open(),this},build:function(t){var e,i,s,l=[],n=this;l[0]=h.createElement("UL"),l[0].className="tail-dropdown",i=l[0];var a=function(e){if("string"==typeof e){if("#"==e)return void(i=l[0]);(i=h.createElement("UL")).className="tail-dropdown-optgroup",i.setAttribute("data-group",e),l.push(i),l[0].appendChild(i),(s=h.createElement("LI")).className="tail-optgroup-title",s.innerHTML="<b>"+e+"</b>"}else(s=h.createElement("LI")).className="tail-dropdown-option"+(e.selected?" selected":"")+(e.disabled?" disabled":""),t&&0<t.length&&n.con.searchMarked?s.innerHTML=e.value.replace(new RegExp("("+t+")","i"),"<mark>$1</mark>"):s.innerText=e.value,n.con.descriptions&&e.description&&(s.innerHTML+='<span class="tail-option-description">'+e.description+"</span>"),s.setAttribute("data-key",e.key),s.addEventListener("click",function(e){n.bind.call(n,e,this)});return i.appendChild(s),s},o=!0;if(void 0===t)for(;e=this.options.walk(this.con.sortItems,this.con.sortGroups,!0);)a(e),"#"!==e&&(o=!1);else for(;e=this.options.finder(t);)a(e),"#"!==e&&(o=!1);return o&&((o=a({key:null,value:c(null==t?"empty":"searchEmpty")})).className+=" label-only"),this.dropdown.querySelector(".tail-dropdown-inner").innerHTML="",this.dropdown.querySelector(".tail-dropdown-inner").appendChild(l[0]),this},bind:function(e,t){if(!t.hasAttribute("data-key"))return!1;var i=t.getAttribute("data-key"),s=t.parentElement.getAttribute("data-group")||"#";this.choose("toggle",i,s)&&(this.con.stayOpen||this.con.multiple||this.close())},callback:function(e,t){if("rebuild"==t)return this.build();if("#"!==e.group)var i=this.dropdown.querySelector("[data-group='"+e.group+"'] [data-key='"+e.key+"']");else i=this.dropdown.querySelector("[data-key='"+e.key+"']");i&&("select"==t?n.addClass(i,"selected"):"unselect"==t?n.removeClass(i,"selected"):"disable"==t?n.addClass(i,"disabled"):"enable"==t&&n.removeClass(i,"disabled")),0<=["select","unselect"].indexOf(t)&&(this.con.multiple?0<=this.con.multiLimit&&this.con.multiLimit<=this.options.selected.length?(n.addClass(this.select,"limit"),this.setLabel("limit")):(n.removeClass(this.select,"limit"),this.setLabel("placeholder")):this.setLabel("unselect"==t?"placeholder":e.value)),this.con.multiple&&this.con.multiShowCount&&this.setCounter(),this.container&&this.setContainer(e,t),n.trigger(this.select,"tail.select::"+t,{bubbles:!1,cancelable:!0,detail:this})},setLabel:function(e){return"placeholder"==e?e="string"==typeof this.con.placeholder&&0<this.con.placeholder.length?this.con.placeholder:c("placeholder"):"limit"==e&&(e=c("limit")),this.label.querySelector(".tail-label-inner").innerText=e,this},setCounter:function(){var e=(this.options.selected||[]).length;return this.label.querySelector(".tail-label-count").innerText=e,this},setContainer:function(e,t){var i=this;if("select"==t){(s=h.createElement("DIV")).innerText=e.value,s.className="tail-select-handle",s.setAttribute("data-key",e.key),s.setAttribute("data-group",e.group),s.addEventListener("click",function(e){e.preventDefault(),i.choose.call(i,"unselect",this.getAttribute("data-key"),this.getAttribute("data-group"))}),this.container.appendChild(s)}else{var s,l="[data-group='"+e.group+"'][data-key='"+e.key+"']";(s=this.container.querySelector(l))&&s.parentElement.removeChild(s)}return this},choose:function(e,t,i){if(t instanceof Array){for(var s in t)this.choose(e,t[s][0],t[s][1]);return this}return"enable"==e||"disable"==e||"toggle"==e&&(e=this.options.is("select",t,i)?"unselect":"select"),this.options.handle(e,t,i)},open:function(){if(n.hasClass(this.select,"active")||n.hasClass(this.select,"idle"))return!1;var e=h.documentElement.offsetHeight,t=this.dropdown.cloneNode(!0);t.style.height="auto",t.style.opacity=0,t.style.display="block",t.style.position="absolue",t.style.visibility="hidden",t.className+=" clone",this.dropdown.parentElement.appendChild(t);var i=t.offsetHeight,s=this.select.offsetTop+i+25;if(this.dropdown.parentElement.removeChild(t),!0===this.con.openAbove||null===this.con.openAbove&&e<=s?n.addClass(this.select,"open-top"):n.removeClass(this.select,"open-top"),this.con.animate){var l=this;n.addClass(l.select,"idle"),this.label.style.zIndex=25,this.dropdown.setAttribute("data-height",i),this.dropdown.style.height="0",this.dropdown.style.overflow="hidden",this.dropdown.style.display="block",n.animate(this.dropdown,function(){var e=parseInt(this.style.height),t=parseInt(this.getAttribute("data-height"));return e<t?(this.style.height=(t<e+50?t:e+50)+"px",!0):(n.addClass(l.select,"active"),n.removeClass(l.select,"idle"),this.removeAttribute("style"),this.removeAttribute("data-height"),l.label.removeAttribute("style"),n.trigger(l.select,"tail.select::open",{bubbles:!1,cancelable:!0,detail:l}),!1)},1,!0)}else n.addClass(this.select,"active"),n.trigger(this.select,"tail.select::open",{bubbles:!1,cancelable:!0,detail:l});return this},close:function(){if(!n.hasClass(this.select,"active")||n.hasClass(this.select,"idle"))return!1;if(this.con.animate){var t=this;n.addClass(this.select,"idle"),this.dropdown.style.overflow="hidden",n.animate(this.dropdown,function(){var e=parseInt(this.offsetHeight);return 0<e-50?(this.style.height=e-50+"px",!0):(n.removeClass(t.select,"idle"),n.removeClass(t.select,"active"),this.removeAttribute("style"),n.trigger(t.select,"tail.select::close",{bubbles:!1,cancelable:!0,detail:t}),!1)},1,!0)}else n.removeClass(this.select,"active"),n.trigger(this.select,"tail.select::close",{bubbles:!1,cancelable:!0,detail:t});return this},toggle:function(){return n.hasClass(this.select,"active")?this.close():this.open()},remove:function(){if(this.e.style.display="inherit",this.e.removeAttribute("data-tail-select"),this.select.parentElement.removeChild(this.select),this.container)for(var e=this.container.querySelectorAll(selector),t=0;t<e.length;t++)this.container.removeChild(e[t]);return this},reload:function(){return this.remove(),new l(this.e,this.con)}};var s=function(e,t){return!!(e.tagName&&"SELECT"==e.tagName&&t instanceof l)&&(void 0===this?new s(e,t):(this.self=t,this.select=e,this))};s.prototype={_replaceTypo:function(e){return e=(e=(e=(e=e.replace("disabled","disable")).replace("enabled","enable")).replace("selected","select")).replace("unselected","unselect")},init:function(){this.length=0,this.selected=[],this.disabled=[],this.items={"#":{}},this.groups={};var e,t,i,s,l=this.select.options.length,n=this.self;for(i=0;i<l;i++)t=(e=this.select.options[i]).value||e.innerText,"#"===(s="OPTGROUP"==e.parentElement.tagName?e.parentElement.label:"#")||s in this.groups||(this.items[s]={},this.groups[s]=e.parentElement),this.items[s][t]={key:t,value:e.innerText,description:e.getAttribute("data-description")||null,group:s,option:e,optgroup:this.groups[s],selected:!1,disabled:!1},!(!n.con.multiple&&n.con.deselect?e.hasAttribute("selected"):e.selected)||e.disabled||this.handle("select",t,s)||(e.selected=!1),e.disabled&&!this.handle("disabled",t,s)&&(e.disabled=!1),this.length++;return this},get:function(e,t){if("object"==typeof e&&e.key&&e.value)return e;if(e instanceof Element&&e.tagName&&("OPTION"==e.tagName?("OPTGROUP"==e.parentElement.tagName&&(t=e.parentElement.label),e=e.value||e.innerText):e.hasAttribute("data-key")&&(e.parentElement.hasAttribute("data-group")&&(optgroup=e.parentElement.getAttribute("data-group")),e=e.getAttribute("data-key"))),"string"!=typeof e)return!1;if("string"==typeof t&&"#"!=t){if(!(t in this.groups))return null;var i=this.items[t]}else i=this.items["#"];return e in i?i[e]:null},set:function(e){if(!e.tagName||"OPTION"!=e.tagName)return!1;var t=e.value||e.text,i=e.parentElement;return"#"==(i="OPTGROUP"==i.tagName?i.label:"#")||i in this.groups||(this.groups[i]=e.parentElement,this.items[i]={}),!(t in this.items[i])&&(e.selected&&this.self.con.multiple?0<=this.self.con.multiLimit&&this.self.con.multiLimit<=this.selected.length&&(e.selected=!1):e.selected&&!this.self.con.multiple&&0<this.selected.length&&(e.selected=!1),this.items[i][t]={key:t,value:e.text,description:e.getAttribute("data-description")||null,group:i,option:e,optgroup:"#"!=i?this.groups[i]:void 0,selected:e.selected,disabled:e.disabled},this.items[i][t].selected&&this.selected.push(this.items[i][t].option),this.items[i][t].disabled&&this.disabled.push(this.items[i][t].option),this.length++,this.self.callback.call(this.self,this.items[i][t],"rebuild"),!0)},add:function(e,t,i,s,l,n){if(null!=this.get(e,i))return!1;if(!((i=void 0===i?"#":i)in this.groups)){var a=h.createElement("OPTGROUP");a.label=i,this.select.appendChild(a),this.groups[i]=a,this.items[i]={}}(s=void 0!==s&&!!s)&&this.self.con.multiple?0<=this.self.con.multiLimit&&this.self.con.multiLimit<=this.selected.length&&(s=!1):s&&!this.self.con.multiple&&0<this.selected.length&&(o.selected=!1),l=void 0!==l&&!!l;var o=h.createElement("OPTION");return o.value=e,o.selected=s,o.disabled=l,o.innerText=t,"string"==typeof n&&o.setAttribute("data-description",n),"#"==i?this.select.appendChild(o):this.groups[i].appendChild(o),this.set(o)},remove:function(e,t){var i=this.get(e,t);return!!i&&(i.selected&&this.handle("unselect",i),i.disabled&&this.handle("enable",i),i.option.parentElement.removeChild(i.option),delete this.items[i.group][i.key],this.length--,0==Object.keys(this.items[i.group]).length&&(delete this.items[i.group],delete this.groups[i.group]),this.self.callback.call(this.self,i,"rebuild"),!0)},is:function(e,t,i){e=this._replaceTypo(e);var s=this.get(t,i);return!s||["select","unselect","disable","enable"].indexOf(e)<0?null:"disable"==e||"enable"==e?"disable"==e?s.disabled:!s.disabled:("select"==e||"unselect"==e)&&("select"==e?s.selected:!s.selected)},handle:function(e,t,i,s){e=this._replaceTypo(e);var l=this.get(t,i);if(!l||["select","unselect","disable","enable"].indexOf(e)<0)return null;if("disable"==e||"enable"==e)return"disable"!=e||l.option in this.disabled?"disable"==e&&l.option in this.selected&&this.disabled.splice(this.disabled.indexOf(l.option),1):this.disabled.push(l.option),l.disabled="disable"==e,l.option.disabled="disable"==e,this.self.callback.call(this.self,l,e),!0;if(l.disabled||l.option.disabled)return!1;if("select"==e){if(this.self.con.multiple&&0<=this.self.con.multiLimit){if(this.self.con.multiLimit<=this.selected.length)return!1}else if(!this.self.con.multiple)for(var n in this.selected)this.handle("unselect",this.selected[n],void 0,!0);this.selected.push(l.option),l.selected=!0,l.option.selected=!0,l.option.setAttribute("selected","selected")}else if("unselect"==e){if(!this.self.con.multiple&&!this.self.con.deselect&&!0!==s)return!1;this.selected.splice(this.selected.indexOf(l.option),1),l.selected=!1,l.option.selected=!1,l.option.removeAttribute("selected")}return this.self.callback.call(this.self,l,e),!0},finder:function(e,t){if(void 0===this._findLoop){if("required"==t)var i='<[^<>]+value="[^"]*'+e+'[^"]*">';else if("optional"==t||"eitheror"==t)i='<[^<>]+(value="[^"]*'+e+'[^"]*")?>';else i="<[^<>]+>";i+="eitheror"==t?"[^<>]*("+e+")?[^<>]*":"[^<>]*("+e+")[^<>]*",i+="<[^<>]+>"}void 0===this._findLoop&&(this._findLoop=!0,this._findRegex=new RegExp(i,"gmi"));for(var s,l,n=this.self.e.innerHTML;null!==this._findRegex.exec(n);)if(l=(n.substr(0,this._findRegex.lastIndex).match(/\<\/option\>/g)||[]).length,null!=(s=this.get(this.self.e.options[l-1])))return s;return delete this._findLoop,delete this._findRegex,!1},find:function(e,t,i){for(var s=new Array;!1!==(item=this.finder(e,t,i));)s.push(item);return s},walk:function(e,t,i){if(void 0!==this._inLoop&&this._inLoop){if(0<this._inItems.length){var s=this._inItems.shift();return this.items[this._inGroup][s]}if(0<this._inGroups.length){for(;0<this._inGroups.length;){var l=this._inGroups.shift(),n=Object.keys(this.items[l]);if(0<n.length)break}return"ASC"==e?n.sort():"DESC"==e?n.sort().reverse():"function"==typeof e&&n.sort(e),this._inItems=n,this._inGroup=l,i?l:this.walk(null,null,i)}return delete this._inLoop,delete this._inItems,delete this._inGroup,delete this._inGroups,!1}var a=Object.keys(this.groups);return"ASC"==t?a.sort():"DESC"==t?a.sort().reverse():"function"==typeof t&&a.sort(t),a.unshift("#"),this._inLoop=!0,this._inItems=[],this._inGroups=a,this.walk(e,null,i)}},void 0===t.tail&&(t.tail={}),t.tail.select=l,t.tail.options=s,n.select}(this);
