/* tail.DateTime 0.3.5 @ https://github.com/pytesNET/tail.select */
!function(e){"function"==typeof define&&define.amd?define(e):(void 0===window.tail&&(window.tail={}),window.tail.select=e())}(function(){"use strict";var e=window,h=window.document,a={hasClass:function(e,t){return new RegExp("(|s+)"+t+"(s+|)").test(e.className)},addClass:function(e,t){return new RegExp("(|s+)"+t+"(s+|)").test(e.className)||(e.className=(e.className.trim()+" "+t.trim()).trim()),e},removeClass:function(e,t){var i=new RegExp("(|s+)("+t+")(s+|)");return i.test(e.className)&&(e.className=e.className.replace(i,"$1$3").trim()),e},trigger:function(e,t,i){if(CustomEvent&&CustomEvent.name)var s=new CustomEvent(t,i);else(s=h.createEvent("CustomEvent")).initCustomEvent(t,!!i.bubbles,!!i.cancelable,i.detail);return e.dispatchEvent(s)},clone:function(e,t){if(t="object"==typeof t?t:{},Object.assign)return Object.assign({},e,t);var i=e.constructor();for(var s in e)s in t?i[s]=t[s]:s in e&&(i[s]=e[s]);return i},animate:function(e,t,i,s){if(e.hasAttribute("data-tail-animation")){if(!s)return;clearInterval(a.animation[e.getAttribute("data-tail-animation")])}e.setAttribute("data-tail-animation","tail-"+ ++this.animationCounter),function(t,i,e){var s=this;this.animation["tail-"+this.animationCounter]=setInterval(function(){var e=t.getAttribute("data-tail-animation");!1===i.call(t,t)&&(clearInterval(s.animation[e]),t.parentElement&&t.removeAttribute("data-tail-animation"))},e)}.call(this,e,t,i)},animation:{},animationCounter:0},l=function(e,t){if("string"==typeof e&&(e=h.querySelectorAll(e)),e instanceof NodeList||e instanceof HTMLCollection){for(var i=[],s=e.length,n=0;n<s;n++)i.push(new l(e[n],t));return 1===i.length?i[0]:0!==i.length&&i}return e instanceof Element&&(!e.tagName||"SELECT"===e.tagName)&&(void 0!==this&&this.init?l.instances[e.getAttribute("data-tail-select")]?l.instances[e.getAttribute("data-tail-select")]:(t="object"==typeof t?t:{},e.hasAttribute("multiple")&&(t.multiple=e.multiple),e.hasAttribute("placeholder")?t.placeholder=e.placeholder:e.hasAttribute("data-placeholder")&&(t.placeholder=e.getAttribute("data-placeholder")),t.width&&"auto"===t.width&&(t.width=e.offsetWidth+30),this.e=e,this.id=++l.count,this.con=a.clone(l.defaults,t),(l.instances["tail-"+this.id]=this).init()):new l(e,t))};l.version="0.3.5",l.status="alpha",l.count=0,l.instances={},l.defaults={width:null,height:null,classNames:null,placeholder:null,deselect:!1,animate:!0,openAbove:null,stayOpen:!1,startOpen:!1,multiple:!1,multiLimit:-1,multiShowCount:!0,multiContainer:!1,descriptions:!1,items:{},sortItems:!1,sortGroups:!1,search:!1,searchFocus:!0,searchMarked:!0,csvOutput:!1,csvSeparator:",",hideSelect:!0,hideSelected:!1,hideDisabled:!1,bindSourceSelect:!1},l.strings={empty:"No Options available",placeholder:"Select an Option...",multiLimit:"You can't select more Options",multiPlaceholder:"Select up to %d Options...",search:"Type in to search...",searchEmpty:"No Options found"};var r=function(e){return l.strings.hasOwnProperty(e)?l.strings[e]:e};l.prototype={e:null,id:0,con:{},options:{},select:null,label:null,dropdown:null,container:null,csvInput:null,init:function(){var c=this,e=new Array("tail-select"),t=!0===this.con.classNames?this.e.className:this.con.classNames;if(("string"==typeof t||t instanceof Array)&&e.push(t instanceof Array?t.join(" "):t),c.con.hideSelected&&e.push("hide-selected"),c.con.hideDisabled&&e.push("hide-disabled"),c.con.multiple&&e.push("multiple"),c.con.deselect&&e.push("deselect"),this.select=h.createElement("DIV"),this.select.className=e.join(" "),isNaN(parseInt(this.con.width,10))||(this.select.style.width=parseInt(this.con.width,10)+"px"),this.label=h.createElement("DIV"),this.label.className="tail-select-label",this.con.multiple&&this.con.multiShowCount&&(this.label.innerHTML='<span class="tail-label-count">0</span>'),this.label.innerHTML+='<span class="tail-label-inner"></span>',this.label.addEventListener("click",function(e){c.toggle.call(c)}),this.select.appendChild(this.label),this.setLabel("placeholder"),this.dropdown=h.createElement("DIV"),this.dropdown.className="tail-select-dropdown",this.dropdown.innerHTML='<div class="tail-dropdown-inner"></div>',isNaN(parseInt(this.con.width,10))||(this.dropdown.style.width=parseInt(this.con.width,10)+"px"),isNaN(parseInt(this.con.height,10))||(this.dropdown.children[0].style.maxHeight=parseInt(this.con.height,10)+"px"),this.select.appendChild(this.dropdown),this.con.search&&(this.search=h.createElement("DIV"),this.search.className="tail-dropdown-search",this.search.innerHTML='<input type="text" class="tail-search-input" />',this.search.querySelector("input").setAttribute("placeholder",r("search")),this.search.querySelector("input").addEventListener("input",function(e){2<this.value.length?c.build(this.value):c.build()}),this.dropdown.insertBefore(this.search,this.dropdown.children[0])),this.con.multiple&&h.querySelector(this.con.multiContainer)&&(this.container=h.querySelector(this.con.multiContainer),this.container.className+=" tail-select-container"),this.con.csvOutput){var i=this.e.getAttribute("name")||this.id;this.e.removeAttribute("name"),this.csvInput=document.createElement("INPUT"),this.csvInput.type="hidden",this.csvInput.name=i,this.csvInput.value="",this.select.appendChild(this.csvInput)}if(this.options=new n(this.e,c),this.options.init(),"object"==typeof this.con.items)for(var s in this.con.items)"string"==typeof this.con.items[s]&&(this.con.items[s]={value:this.con.items[s]}),this.options.add(s,this.con.items[s].value,this.con.items[s].group,this.con.items[s].selected,this.con.items[s].disabled);return this.build(),h.addEventListener("click",function(e){a.hasClass(c.select,"active")&&(c.select.contains(e.target)||c.e.contains(e.target)||e.target!=c.select&&e.target!=c.e&&(c.con.stayOpen||c.close.call(c)))}),this.con.bindSourceSelect&&this.e.addEventListener("change",function(e){var t=function(e,t){for(var i,s,n,l,a=c.options.selected.slice(0),o=e.length,r=0;r<o;r++)s=(i=e[r]).value||i.innerText,l="OPTGROUP"==i.parentElement.tagName?i.parentElement.label:"#",null!=(n=c.options.get(s,l))&&(c.options.is("selected",n)||c.options.handle("select",n),0<=a.indexOf(i)&&a.splice(a.indexOf(i),1));for(var r in a)c.options.handle("unselect",a[r])};if(!this.multiple&&this.selectedIndex)c.choose("select",this.options[this.selectedIndex]);else if(this.selectedOptions)t(this.selectedOptions);else{for(var i=[],s=this.options.length,n=0;n<s;n++)this.options[n].selected&&i.push(this.options[n]);t(i)}}),this.e.parentElement.insertBefore(this.select,this.e),this.e.setAttribute("data-tail-select","tail-"+this.id),this.con.hideSelect&&(this.e.style.display="none"),c.con.startOpen&&this.open(),this},build:function(t){var i,s,n=[],l=this;n[0]=h.createElement("UL"),n[0].className="tail-dropdown",i=n[0];for(var e,a=function(e){if("string"==typeof e){if("#"==e)return void(i=n[0]);(i=h.createElement("UL")).className="tail-dropdown-optgroup",i.setAttribute("data-group",e),n.push(i),n[0].appendChild(i),(s=h.createElement("LI")).className="tail-optgroup-title",s.innerHTML="<b>"+e+"</b>"}else(s=h.createElement("LI")).className="tail-dropdown-option"+(e.selected?" selected":"")+(e.disabled?" disabled":""),t&&0<t.length&&l.con.searchMarked?(t=t.replace(/[\[\]\{\}\(\)\*\+\?\.\,\^\$\\\|\#\-]/g,"\\$&"),s.innerHTML=e.value.replace(new RegExp("("+t+")","i"),"<mark>$1</mark>")):s.innerText=e.value,l.con.descriptions&&e.description&&(s.innerHTML+='<span class="tail-option-description">'+e.description+"</span>"),s.setAttribute("data-key",e.key),s.setAttribute("data-group",e.group),s.addEventListener("click",function(e){l.bind.call(l,e,this)});return i.appendChild(s),s},o=!0;e="string"==typeof t?this.options.finder(t):this.options.walk(this.con.sortItems,this.con.sortGroups,!0);)a(e),"#"!==e&&o&&(o=!1);return o&&((o=a({key:null,value:r(null==t?"empty":"searchEmpty")})).className+=" label-only"),this.dropdown.querySelector(".tail-dropdown-inner").innerHTML="",this.dropdown.querySelector(".tail-dropdown-inner").appendChild(n[0]),this},bind:function(e,t){if(!t.hasAttribute("data-key"))return!1;var i=t.getAttribute("data-key"),s=t.getAttribute("data-group")||"#";this.choose("toggle",i,s)&&(this.con.stayOpen||this.con.multiple||this.close())},callback:function(e,t){if("rebuild"==t)return this.build();var i=this.dropdown.querySelector("[data-key='"+e.key+"'][data-group='"+e.group+"']");if(i&&("select"==t?a.addClass(i,"selected"):"unselect"==t?a.removeClass(i,"selected"):"disable"==t?a.addClass(i,"disabled"):"enable"==t&&a.removeClass(i,"disabled")),0<=["select","unselect"].indexOf(t)&&(this.con.multiple?0<=this.con.multiLimit&&this.con.multiLimit<=this.options.selected.length?(a.addClass(this.select,"limit"),this.setLabel("limit")):(a.removeClass(this.select,"limit"),this.setLabel("placeholder")):this.setLabel("unselect"==t?"placeholder":e.value)),this.con.multiple&&this.con.multiShowCount&&this.setCounter(),this.container&&this.setContainer(e,t),this.csvInput&&this.con.csvOutput&&0<=["select","unselect"].indexOf(t)){for(var s=[],n=this.options.selected.length,l=0;l<n;l++)s.push(this.options.selected[l].value);this.csvInput.value=s.join(this.con.csvSeparator||",")}a.trigger(this.select,"tail.select::"+t,{bubbles:!1,cancelable:!0,detail:this})},setLabel:function(e){return"placeholder"==e?e="string"==typeof this.con.placeholder&&0<this.con.placeholder.length?this.con.placeholder:this.con.multiple&&0<this.con.multiLimit?r("multiPlaceholder").replace("%d",this.con.multiLimit):r("placeholder"):"limit"==e&&(e=r("multiLimit")),this.label.querySelector(".tail-label-inner").innerText=e,this},setCounter:function(){var e=(this.options.selected||[]).length;return this.label.querySelector(".tail-label-count").innerText=e,this},setContainer:function(e,t){var i=this;if("select"==t){(s=h.createElement("DIV")).innerText=e.value,s.className="tail-select-handle",s.setAttribute("data-key",e.key),s.setAttribute("data-group",e.group),s.addEventListener("click",function(e){e.preventDefault(),i.choose.call(i,"unselect",this.getAttribute("data-key"),this.getAttribute("data-group"))}),this.container.appendChild(s)}else{var s,n="[data-group='"+e.group+"'][data-key='"+e.key+"']";(s=this.container.querySelector(n))&&s.parentElement.removeChild(s)}return this},choose:function(e,t,i){if(t instanceof Array){for(var s in t)this.choose(e,t[s][0],t[s][1]);return this}return"enable"==e||"disable"==e||"toggle"==e&&(e=this.options.is("select",t,i)?"unselect":"select"),this.options.handle(e,t,i)},open:function(){if(a.hasClass(this.select,"active")||a.hasClass(this.select,"idle"))return!1;var e=h.documentElement.offsetHeight,t=this.dropdown.cloneNode(!0);t.style.cssText+="height:auto;opacity:0;display:block;visibility:hidden;",t.className+=" clone",this.dropdown.parentElement.appendChild(t);var i=t.offsetHeight,s=this.select.offsetTop+i+25;if(this.dropdown.parentElement.removeChild(t),!0===this.con.openAbove||null===this.con.openAbove&&e<=s?a.addClass(this.select,"open-top"):a.removeClass(this.select,"open-top"),this.con.animate){var n=this;a.addClass(n.select,"idle"),this.label.style.zIndex=25,this.dropdown.setAttribute("data-height",i),this.dropdown.style.cssText+="height:0;display:block;overflow:hidden;",a.animate(this.dropdown,function(){var e=parseInt(this.style.height,10),t=parseInt(this.getAttribute("data-height"),10);return e<t?(this.style.height=(t<e+50?t:e+50)+"px",!0):(a.addClass(n.select,"active"),a.removeClass(n.select,"idle"),this.removeAttribute("style"),this.removeAttribute("data-height"),n.label.removeAttribute("style"),a.trigger(n.select,"tail.select::open",{bubbles:!1,cancelable:!0,detail:n}),n.con.search&&n.con.searchFocus&&n.dropdown.querySelector("input").focus(),!1)},1,!0)}else a.addClass(this.select,"active"),a.trigger(this.select,"tail.select::open",{bubbles:!1,cancelable:!0,detail:n}),this.con.search&&this.con.searchFocus&&this.dropdown.querySelector("input").focus();return this},close:function(){if(!a.hasClass(this.select,"active")||a.hasClass(this.select,"idle"))return!1;if(this.con.animate){var t=this;a.addClass(this.select,"idle"),this.dropdown.style.overflow="hidden",a.animate(this.dropdown,function(){var e=parseInt(this.offsetHeight,10);return 0<e-50?(this.style.height=e-50+"px",!0):(a.removeClass(t.select,"idle"),a.removeClass(t.select,"active"),this.removeAttribute("style"),a.trigger(t.select,"tail.select::close",{bubbles:!1,cancelable:!0,detail:t}),!1)},1,!0)}else a.removeClass(this.select,"active"),a.trigger(this.select,"tail.select::close",{bubbles:!1,cancelable:!0,detail:t});return this},toggle:function(){return a.hasClass(this.select,"active")?this.close():this.open()},remove:function(){if(this.e.style.display="inherit",this.e.removeAttribute("data-tail-select"),this.csvInput&&this.e.setAttribute("name",this.csvInput.getAttribute("name")),this.select.parentElement.removeChild(this.select),this.container)for(var e=this.container.querySelectorAll(selector),t=e.length,i=0;i<t;i++)this.container.removeChild(e[i]);return this},reload:function(){return this.remove(),new l(this.e,this.con)}};var n=function(e,t){return!!(e.tagName&&"SELECT"==e.tagName&&t instanceof l)&&(void 0===this?new n(e,t):(this.self=t,this.select=e,this))};return n.prototype={_replaceTypo:function(e){return e=(e=(e=(e=e.replace("disabled","disable")).replace("enabled","enable")).replace("selected","select")).replace("unselected","unselect")},init:function(){this.length=0,this.selected=[],this.disabled=[],this.items={"#":{}},this.groups={};var e,t,i,s,n=this.select.options.length,l=this.self;for(i=0;i<n;i++){if(t=(e=this.select.options[i]).value||e.innerText,"#"===(s="OPTGROUP"==e.parentElement.tagName?e.parentElement.label:"#")||s in this.groups||(this.items[s]={},this.groups[s]=e.parentElement),e.hasAttribute("data-description")){var a=h.createElement("SPAN");a.innerHTML=e.getAttribute("data-description"),e.setAttribute("data-description",a.innerHTML)}this.items[s][t]={key:t,value:e.innerText,description:e.getAttribute("data-description")||null,group:s,option:e,optgroup:this.groups[s],selected:!1,disabled:!1},!(!l.con.multiple&&l.con.deselect?e.hasAttribute("selected"):e.selected)||e.disabled||this.handle("select",t,s)||(e.selected=!1),e.disabled&&!this.handle("disabled",t,s)&&(e.disabled=!1),this.length++}return this},get:function(e,t){if("object"==typeof e&&e.key&&e.value)return e;if(e instanceof Element&&e.tagName&&("OPTION"==e.tagName?("OPTGROUP"==e.parentElement.tagName&&(t=e.parentElement.label),e=e.value||e.innerText):e.hasAttribute("data-key")&&(e.parentElement.hasAttribute("data-group")&&(optgroup=e.parentElement.getAttribute("data-group")),e=e.getAttribute("data-key"))),"string"!=typeof e)return!1;if("string"==typeof t&&"#"!=t){if(!(t in this.groups))return null;var i=this.items[t]}else i=this.items["#"];return e in i?i[e]:null},set:function(e){if(!e.tagName||"OPTION"!=e.tagName)return!1;var t=e.value||e.text,i=e.parentElement;return"#"==(i="OPTGROUP"==i.tagName?i.label:"#")||i in this.groups||(this.groups[i]=e.parentElement,this.items[i]={}),!(t in this.items[i])&&(e.selected&&this.self.con.multiple?0<=this.self.con.multiLimit&&this.self.con.multiLimit<=this.selected.length&&(e.selected=!1):e.selected&&!this.self.con.multiple&&0<this.selected.length&&(e.selected=!1),this.items[i][t]={key:t,value:e.text,description:e.getAttribute("data-description")||null,group:i,option:e,optgroup:"#"!=i?this.groups[i]:void 0,selected:e.selected,disabled:e.disabled},this.items[i][t].selected&&this.selected.push(this.items[i][t].option),this.items[i][t].disabled&&this.disabled.push(this.items[i][t].option),this.length++,this.self.callback.call(this.self,this.items[i][t],"rebuild"),!0)},add:function(e,t,i,s,n,l){if(null!=this.get(e,i))return!1;if(!((i=void 0===i?"#":i)in this.groups)){var a=h.createElement("OPTGROUP");a.label=i,this.select.appendChild(a),this.groups[i]=a,this.items[i]={}}(s=void 0!==s&&!!s)&&this.self.con.multiple?0<=this.self.con.multiLimit&&this.self.con.multiLimit<=this.selected.length&&(s=!1):s&&!this.self.con.multiple&&0<this.selected.length&&(r.selected=!1),n=void 0!==n&&!!n;var r=h.createElement("OPTION");if(r.value=e,r.selected=s,r.disabled=n,r.innerText=t,"string"==typeof l){var c=h.createElement("SPAN");c.innerHTML=o.getAttribute("data-description"),o.setAttribute("data-description",c.innerHTML)}return"#"==i?this.select.appendChild(r):this.groups[i].appendChild(r),this.set(r)},remove:function(e,t){var i=this.get(e,t);return!!i&&(i.selected&&this.handle("unselect",i),i.disabled&&this.handle("enable",i),i.option.parentElement.removeChild(i.option),delete this.items[i.group][i.key],this.length--,0===Object.keys(this.items[i.group]).length&&(delete this.items[i.group],delete this.groups[i.group]),this.self.callback.call(this.self,i,"rebuild"),!0)},is:function(e,t,i){e=this._replaceTypo(e);var s=this.get(t,i);return!s||["select","unselect","disable","enable"].indexOf(e)<0?null:"disable"==e||"enable"==e?"disable"==e?s.disabled:!s.disabled:("select"==e||"unselect"==e)&&("select"==e?s.selected:!s.selected)},handle:function(e,t,i,s){e=this._replaceTypo(e);var n=this.get(t,i);if(!n||["select","unselect","disable","enable"].indexOf(e)<0)return null;if("disable"==e||"enable"==e)return"disable"!=e||n.option in this.disabled?"disable"==e&&n.option in this.selected&&this.disabled.splice(this.disabled.indexOf(n.option),1):this.disabled.push(n.option),n.disabled="disable"==e,n.option.disabled="disable"==e,this.self.callback.call(this.self,n,e),!0;if(n.disabled||n.option.disabled)return!1;if("select"==e){if(this.self.con.multiple&&0<=this.self.con.multiLimit){if(this.self.con.multiLimit<=this.selected.length)return!1}else if(!this.self.con.multiple)for(var l in this.selected)this.handle("unselect",this.selected[l],void 0,!0);this.selected.push(n.option),n.selected=!0,n.option.selected=!0,n.option.setAttribute("selected","selected")}else if("unselect"==e){if(!this.self.con.multiple&&!this.self.con.deselect&&!0!==s)return!1;this.selected.splice(this.selected.indexOf(n.option),1),n.selected=!1,n.option.selected=!1,n.option.removeAttribute("selected")}return this.self.callback.call(this.self,n,e),!0},finder:function(e,t){if(void 0===this._findLoop){if(e=e.replace(/[\[\]{}()*+?.,^$\\|#-]/g,"\\$&"),"required"==t)var i='<[^<>]+value="[^"]*'+e+'[^"]*">';else if("optional"==t||"eitheror"==t)i='<[^<>]+(value="[^"]*'+e+'[^"]*")?>';else i="<[^<>]+>";i+="eitheror"==t?"[^<>]*("+e+")?[^<>]*":"[^<>]*("+e+")[^<>]*",i+="<[^<>]+>"}void 0===this._findLoop&&(this._findLoop=!0,this._findRegex=new RegExp(i,"gmi"));for(var s,n,l=this.self.e.innerHTML;null!==this._findRegex.exec(l);)if(n=(l.substr(0,this._findRegex.lastIndex).match(/\<\/option\>/g)||[]).length,null!=(s=this.get(this.self.e.options[n-1])))return s;return delete this._findLoop,delete this._findRegex,!1},find:function(e,t,i){for(var s=[];!1!==(item=this.finder(e,t,i));)s.push(item);return s},walk:function(e,t,i){if(void 0!==this._inLoop&&this._inLoop){if(0<this._inItems.length){var s=this._inItems.shift();return this.items[this._inGroup][s]}if(0<this._inGroups.length){for(;0<this._inGroups.length;){var n=this._inGroups.shift(),l=Object.keys(this.items[n]);if(0<l.length)break}return"ASC"==e?l.sort():"DESC"==e?l.sort().reverse():"function"==typeof e&&l.sort(e),this._inItems=l,this._inGroup=n,i?n:this.walk(null,null,i)}return delete this._inLoop,delete this._inItems,delete this._inGroup,delete this._inGroups,!1}var a=Object.keys(this.groups);return"ASC"==t?a.sort():"DESC"==t?a.sort().reverse():"function"==typeof t&&a.sort(t),a.unshift("#"),this._inLoop=!0,this._inItems=[],this._inGroups=a,this.walk(e,null,i)}},"undefined"!=typeof jQuery&&(jQuery.fn.tailselect=function(e){var t=[];return this.each(function(){var e=l(this);e&&t.push(e)}),1===t.length?t[0]:0!==t.length&&t}),"undefined"!=typeof MooTools&&Element.implement({tailselect:function(e){return new l(this,e)}}),void 0===e.tail&&(e.tail={}),e.tail.select=l,e.tail.options=n,l});
